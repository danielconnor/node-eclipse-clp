<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Merge</TITLE>
<META NAME="description" CONTENT="Merge">
<META NAME="keywords" CONTENT="tutorial">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="tutorial.css">
<LINK REL="next" HREF="node37.html">
<LINK REL="previous" HREF="node35.html">
<LINK REL="up" HREF="node24.html">
<LINK REL="next" HREF="node37.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html1018"
 HREF="node37.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html1012"
 HREF="node24.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html1006"
 HREF="node35.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A> 
<A NAME="tex2html1014"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents_motif.gif"></A> 
<A NAME="tex2html1016"
 HREF="node78.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1019"
 HREF="node37.html">Group</A>
<B> Up:</B> <A NAME="tex2html1013"
 HREF="node24.html">Programming Concepts</A>
<B> Previous:</B> <A NAME="tex2html1007"
 HREF="node35.html">Sum</A>
 &nbsp <B>  <A NAME="tex2html1015"
 HREF="node1.html">Contents</A></B> 
 &nbsp <B>  <A NAME="tex2html1017"
 HREF="node78.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html1020"
 HREF="node36.html#SECTION006120010000000000000">Description</A>
<LI><A NAME="tex2html1021"
 HREF="node36.html#SECTION006120020000000000000">Parameters</A>
<LI><A NAME="tex2html1022"
 HREF="node36.html#SECTION006120030000000000000">Schema</A>
<LI><A NAME="tex2html1023"
 HREF="node36.html#SECTION006120040000000000000">Comments</A>
<LI><A NAME="tex2html1024"
 HREF="node36.html#SECTION006120050000000000000">Example</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION006120000000000000000">
Merge</A>
</H1>

<H4><A NAME="SECTION006120010000000000000">
Description</A>
</H4>
The merge <A NAME="697"></A>concept is used when we want to match corresponding entries in two lists. We sort both lists on the same key, and then scan them in parallel, always discarding the entry with the smallest key first.

<P>
We can use this concept to combine information from the two lists, to find differences between lists <A NAME="698"></A>quickly, or to lookup <A NAME="699"></A>information from the second list for all elements of the first list.

<H4><A NAME="SECTION006120020000000000000">
Parameters</A>
</H4>
<DL>
<DT><STRONG>L</STRONG>
<DD>a list
<DT><STRONG>K</STRONG>
<DD>a list
</DL>
<H4><A NAME="SECTION006120030000000000000">
Schema</A>
</H4>
<PRE>
:-mode merge(+,+).
merge(L,K):-
        sort_on_key(L,L1),
        sort_on_key(K,K1),
        merge_lp(L1,K1).

merge_lp([],_):-
        !.
merge_lp([_|_],[]):-
        !.
merge_lp([A|A1],[B|B1]):-
        merge_compare(A,B,Op),
        merge_cont(Op,A,A1,B,B1).

merge_cont(&lt;,A,A1,B,B1):-
        merge_lp(A1,[B|B1]).
merge_cont(=,A,A1,B,B1):-
        merge_op(A,B),
        merge_lp(A1,[B|B1]).
merge_cont(&gt;,A,A1,B,B1):-
        merge_lp([A|A1],B1).
</PRE>
<H4><A NAME="SECTION006120040000000000000">
Comments</A>
</H4>
The cuts in <I>merge_lp</I> are used to remove choicepoints<A NAME="708"></A> left by the compiler<A NAME="tex2html12"
 HREF="footnode.html#foot709"><SUP>5.1</SUP></A>.

<P>
The schema looks quite complex, but its performance is nearly always significantly better than a simple lookup in the second list.

<H4><A NAME="SECTION006120050000000000000">
Example</A>
</H4>
The example takes data from two different sources and merges it. The first argument is a list of <I>interface_topology</I> terms, the second a list of <I>ndi_interface</I> structures. For matching <!-- MATH: $Node-Interface$ -->
<I>Node</I>-<I>Interface</I> pairs, we copy information from the first structure into the second. If the <!-- MATH: $Node-Interface$ -->
<I>Node</I>-<I>Interface</I> pairs do not match, then we don't do anything.

<P>
Also note the use of <I>compare/3</I> to obtain a lexicographical ordering of <!-- MATH: $Node-Interface$ -->
<I>Node</I>-<I>Interface</I> pairs.

<P>
<A NAME="714"></A>
<A NAME="715"></A>
<A NAME="716"></A>
<PRE>
:-mode insert_topology(+,+).
insert_topology([],_):-
        !.
insert_topology([_|_],[]):-
        !.
insert_topology([A|A1],[B|B1]):-
        compare_index_interface(A,B,Op),
        insert_topology_op(Op,A,B,A1,B1).

compare_index_interface(interface_topology(_,Router1,
                                           Index1,_,_),
                  ndi_interface with [router:Router2,
                                      index:Index2],Op):-
        compare(Op,Router1-Index1,Router2-Index2).

insert_topology_op(&lt;,A,B,A1,B1):-
        insert_topology(A1,[B|B1]).
insert_topology_op(=,A,B,A1,B1):-
        insert_one_topology(A,B),
        insert_topology(A1,B1).
insert_topology_op(&gt;,A,_B,A1,B1):-
        insert_topology([A|A1],B1).

insert_one_topology(interface_topology(_,_,_,Ip,Mask),
                    ndi_interface with [ip_address:Ip,
                                    subnet_mask:Mask,
                                    subnet:Subnet]):-
        subnet(Ip,Mask,Subnet).
</PRE>

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html1018"
 HREF="node37.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html1012"
 HREF="node24.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html1006"
 HREF="node35.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A> 
<A NAME="tex2html1014"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents_motif.gif"></A> 
<A NAME="tex2html1016"
 HREF="node78.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1019"
 HREF="node37.html">Group</A>
<B> Up:</B> <A NAME="tex2html1013"
 HREF="node24.html">Programming Concepts</A>
<B> Previous:</B> <A NAME="tex2html1007"
 HREF="node35.html">Sum</A>
 &nbsp <B>  <A NAME="tex2html1015"
 HREF="node1.html">Contents</A></B> 
 &nbsp <B>  <A NAME="tex2html1017"
 HREF="node78.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey</I>
<BR><I>2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
