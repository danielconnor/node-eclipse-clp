<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Coding External Predicates</TITLE>
<META NAME="description" CONTENT="Coding External Predicates">
<META NAME="keywords" CONTENT="embroot">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="embroot.css">
<LINK REL="next" HREF="node13.html">
<LINK REL="previous" HREF="node11.html">
<LINK REL="up" HREF="node11.html">
<LINK REL="next" HREF="node13.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html840"
 HREF="node13.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html836"
 HREF="node11.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html830"
 HREF="node11.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html838"
 HREF="node76.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html841"
 HREF="node13.html">Compiling and loading</A>
<B> Up:</B> <A NAME="tex2html837"
 HREF="node11.html">External Predicates in C</A>
<B> Previous:</B> <A NAME="tex2html831"
 HREF="node11.html">External Predicates in C</A>
 &nbsp <B>  <A NAME="tex2html839"
 HREF="node76.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION00410000000000000000">
Coding External Predicates</A>
</H1>

<P>
External Predicates are C/C++ functions that can be called like predicates
from ECLiPSe.
Two following extra interface functions are provided for this purpose:
<DL>
<DT><STRONG>EC_word EC_arg(int i)</STRONG>
<DD>returns the i'th argument of the predicate call.

<P>
<DT><STRONG>pword ec_arg(int i)</STRONG>
<DD> 
<BR>
same for C.

<P>
<DT><STRONG>int unify(EC_word, EC_word)</STRONG>
<DD> 
<BR>
unify two pwords.  The return code indicates success or
	failure.  Note however, that if attributed variables are
	involved, their handlers have not been invoked yet (this
	happens after the external predicate returns).

<P>
<DT><STRONG>int EC_word::unify(EC_word)</STRONG>
<DD> 
<BR>
same as method.

<P>
<DT><STRONG>int ec_unify(pword, pword)</STRONG>
<DD> 
<BR>
same for C.
</DL>

<P>
Apart from that, all functions for constructing, testing and decomposing
ECLiPSe data can be used in writing the external predicate
(see chapter <A HREF="node6.html#chapmixed">3</A>).
Here are two examples working with lists, the first one constructing
a list in C:<PRE>
#include "eclipse.h"
int
p_string_to_list()         /* string_to_list(+String, -List) */
{
    pword  list;
    char *s;
    long len;
    int res;

    res = ec_get_string_length(ec_arg(1), &amp;s, &amp;len);
    if (res != PSUCCEED) return res;

    list = ec_nil();    /* build the list backwards */
    while (len--)
        list = ec_list(ec_long(s[len]), list);

    return ec_unify(ec_arg(2), list);
}
</PRE>
The next example uses an input list of integers and sums up the numbers.
It is written in C++:<PRE>
#include "eclipseclass.h"
extern "C" int
p_sumlist()
{
    int res;
    long x, sum = 0;
    EC_word list(EC_arg(1));
    EC_word car,cdr;

    for ( ; list.is_list(car,cdr) == EC_succeed; list = cdr)
    {
        res = car.is_long(&amp;x);
        if (res != EC_succeed) return res;
        sum += x;
    }
    res = list.is_nil();
    if (res != EC_succeed) return res;
    return unify(EC_arg(2), EC_word(sum));
}
</PRE>
The source code of these examples can be found in directory
doc/examples within the ECLiPSe installation.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html840"
 HREF="node13.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html836"
 HREF="node11.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html830"
 HREF="node11.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html838"
 HREF="node76.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html841"
 HREF="node13.html">Compiling and loading</A>
<B> Up:</B> <A NAME="tex2html837"
 HREF="node11.html">External Predicates in C</A>
<B> Previous:</B> <A NAME="tex2html831"
 HREF="node11.html">External Predicates in C</A>
 &nbsp <B>  <A NAME="tex2html839"
 HREF="node76.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey</I>
<BR><I>2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
