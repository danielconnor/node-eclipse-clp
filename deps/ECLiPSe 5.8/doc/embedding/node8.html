<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Converting ECLiPSe data to C data</TITLE>
<META NAME="description" CONTENT="Converting ECLiPSe data to C data">
<META NAME="keywords" CONTENT="embroot">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="embroot.css">
<LINK REL="next" HREF="node9.html">
<LINK REL="previous" HREF="node7.html">
<LINK REL="up" HREF="node6.html">
<LINK REL="next" HREF="node9.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html787"
 HREF="node9.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html783"
 HREF="node6.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html777"
 HREF="node7.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html785"
 HREF="node76.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html788"
 HREF="node9.html">Referring to ECLiPSe terms</A>
<B> Up:</B> <A NAME="tex2html784"
 HREF="node6.html">Managing Data and Memory</A>
<B> Previous:</B> <A NAME="tex2html778"
 HREF="node7.html">Constructing ECLiPSe data</A>
 &nbsp <B>  <A NAME="tex2html786"
 HREF="node76.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html789"
 HREF="node8.html#SECTION00321000000000000000">Converting simple ECLiPSe terms to C data types</A>
<LI><A NAME="tex2html790"
 HREF="node8.html#SECTION00322000000000000000">Decomposing ECLiPSe terms</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION00320000000000000000">
Converting ECLiPSe data to C data</A>
</H1>

<P>
<A NAME="474"></A>
There are several aspects to examining the contents of a term. These
include decomposing compound terms such as lists and structures,
converting simple terms to C data types and testing the types of terms.

<P>
The functions for decomposing and converting check that the type
is appropriate. If it is they return <code>EC_succeed</code> if not
they return a negative error code.

<P>

<H2><A NAME="SECTION00321000000000000000">
Converting simple ECLiPSe terms to C data types</A>
</H2>

<P>
To convert from an ECLiPSe term to a C type you first have to
declare a variable with that type. For fixed size data types
(you can convert to <code>double</code>, <code>long</code> and <code>dident</code>
fixed size data types) you are responsible for allocating the
memory. For strings you declare a <code>char*</code> variable and
on conversion it will point to the internal ECLiPSe string.
<A NAME="478"></A>

<P>
In the following example we see how one can try to convert to
different types. Of course normally you will know what type
you are expecting so only one of these functions need be called.
<PRE>
    EC_word term;
    double r;
    long i;
    EC_atom did;
    char *s;
    if (EC_succeed == term.is_double(&amp;d))
        cout &lt;&lt; d &lt;&lt; "\n";
    else if (EC_succeed == term.is_long(&amp;i))
        cout &lt;&lt; i &lt;&lt; "\n";
    else if (EC_succeed == term.is_atom(&amp;did))
        cout &lt;&lt; did.Name() &lt;&lt; "\n";
    else if (EC_succeed == term.is_string(&amp;s))
        cout &lt;&lt; s &lt;&lt; "\n";
    else
        cout &lt;&lt; "not a simple type\n";
</PRE>

<P>
The term is converted by the function which returns <code>EC_success</code>.
The functions that fail to convert will return a negative error number.

<P>
<A NAME="481"></A>
<A NAME="482"></A>
Care has to be taken with strings, these pointers point to the internal
ECLiPSe string which may move or be garbage collected during an ECLiPSe
execution. As a result if a string is to be kept permanently one should
copy it first.

<P>

<H2><A NAME="SECTION00322000000000000000">
Decomposing ECLiPSe terms</A>
</H2>

<P>
The function <code>ec_get_arg(index,term,&amp;subterm)</code> is used to get
the index'th subterm of a structure. The index varies from 1 to
arity of <code>term</code>. A list can also be decomposed this way, where
the head is at index 1 and the tail at index 2.
<A NAME="486"></A>
<A NAME="487"></A>

<P>
Below we see how we would write a function to find the nth element of
a list.
<PRE>
    int nth(const int n,const EC_word list, EC_word&amp; el)
    {
        EC_word tail = list;
        for (int i=1, i&lt;n, i++)
            if (EC_fail == tail.arg(2,tail))
                return EC_fail;
        return tail.arg(1,el);
    }
</PRE>
The above function actually is not limited to lists but could work
on any nested structure.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html787"
 HREF="node9.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html783"
 HREF="node6.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html777"
 HREF="node7.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html785"
 HREF="node76.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html788"
 HREF="node9.html">Referring to ECLiPSe terms</A>
<B> Up:</B> <A NAME="tex2html784"
 HREF="node6.html">Managing Data and Memory</A>
<B> Previous:</B> <A NAME="tex2html778"
 HREF="node7.html">Constructing ECLiPSe data</A>
 &nbsp <B>  <A NAME="tex2html786"
 HREF="node76.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey</I>
<BR><I>2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
