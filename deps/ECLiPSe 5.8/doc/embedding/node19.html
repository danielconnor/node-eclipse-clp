<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Communication via Queues</TITLE>
<META NAME="description" CONTENT="Communication via Queues">
<META NAME="keywords" CONTENT="embroot">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="embroot.css">
<LINK REL="next" HREF="node20.html">
<LINK REL="previous" HREF="node18.html">
<LINK REL="up" HREF="node15.html">
<LINK REL="next" HREF="node20.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html936"
 HREF="node20.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html932"
 HREF="node15.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html926"
 HREF="node18.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html934"
 HREF="node76.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html937"
 HREF="node20.html">Attaching Handlers to Queues</A>
<B> Up:</B> <A NAME="tex2html933"
 HREF="node15.html">Embedding into Tcl/Tk</A>
<B> Previous:</B> <A NAME="tex2html927"
 HREF="node18.html">Passing Goals and Control</A>
 &nbsp <B>  <A NAME="tex2html935"
 HREF="node76.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html938"
 HREF="node19.html#SECTION00541000000000000000">From-ECLiPSe to Tcl</A>
<LI><A NAME="tex2html939"
 HREF="node19.html#SECTION00542000000000000000">To-ECLiPSe from Tcl</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION00540000000000000000"></A>
<A NAME="tclembedqueues"></A>
<BR>
Communication via Queues
</H1>

<P>
<A NAME="ecqueueconnect"></A>The most flexible way of passing data between ECLiPSe and Tcl is
via the I/O facilities of the two languages,
ie. via ECLiPSe queue streams which can be connected to Tcl channels.

<P>
Currently, a communication channel between ECLiPSe and Tcl is created
from Tcl, which appears as an ECLiPSe queue in ECLiPSe, and a channel
in Tcl. The queue has a symbolic name and a stream number in ECLiPSe,
and has a channel name in Tcl. Facilities are provided to interconvert
between these names. 

<P>
Queues pass data between ECLiPSe and Tcl in one direction: either from
ECLiPSe to Tcl (from-ECLiPSe), or from Tcl to ECLiPSe
(to-ECLiPSe). Queues are created with the direction specified. The
queues should be viewed as communication channels: data is written to the
queue, and it only becomes available to the other side when the queue is
flushed. This is done by calling the predicate <A NAME="tex2html115"
 HREF="../bips/kernel/iostream/flush-1.html">flush/1</A><A NAME="1343"></A> on the
ECLiPSe side, and by invoking <B>ec_flush</B> on the Tcl side. The flush
also has the effect of briefly transferring control to the other side to
allow handlers to handle the data (see
section&nbsp;<A HREF="node20.html#embtclhandlers">5.5</A>)<A NAME="tex2html106"

HREF="footnode.html#foot1048"><SUP>5.1</SUP></A>
<P>
<DL>
<DT><STRONG><A NAME="1050"></A>ec_queue_create <I>eclipse_stream_name mode ?command? ?event?</I></STRONG>
<DD> 
<BR>
Creates a queue between Tcl and ECLiPSe. On
        the Tcl side, a Tcl channel is created. On the ECLiPSe side, the 
        queue would be given the symbolic name <I>eclipse_stream_name</I>. 
        The <I>mode</I> argument indicates the direction of the queue, and
        can either be fromec or toec<A NAME="tex2html108"
 HREF="footnode.html#foot1328"><SUP>5.2</SUP></A>.
        The procedure returns a channel identifier for use in commands
        like <B>puts</B>, <B>read</B>, <B>ec_read_exdr</B>,
        <B>ec_write_exdr</B> or <B>close</B>. The optional arguments <I>        command</I> and <I>event</I> specifies the data handler for the
        queue: <I>command</I> is the name
        of the Tcl
        procedure for handling the data, with its user defined arguments. 
        <I>event</I> is the name of the event that will be
        raised on the ECLiPSe side.
        As a handler can only be defined for one side,
        either <I>event</I> or <I>command</I> should be undefined
        (<code>{}</code>). 

<P>
<DT><STRONG><A NAME="1069"></A>ec_queue_close <I>eclipse_stream_name</I></STRONG>
<DD> 
<BR>
Closes the queue with the ECLiPSe name of <I>	ec_stream_name</I>. 

<P>
<DT><STRONG><A NAME="1073"></A>ec_stream_nr <I>eclipse_stream_name</I></STRONG>
<DD> 
<BR>
This command returns the ECLiPSe stream number given a
        symbolic stream name (this is the same operation that the
        ECLiPSe built-in
        <A NAME="tex2html117"
 HREF="../bips/kernel/iostream/get_stream-2.html">get_stream/2</A><A NAME="1346"></A>

performs). 

<P>
<DT><STRONG><A NAME="1079"></A>ec_streamname_to_streamnum <I>eclipse_stream_name</I></STRONG>
<DD> 
<BR>
This is an alias for <I>ec_stream_nr</I> for compatibility purposes.

<P>
<DT><STRONG><A NAME="1082"></A>ec_streamname_to_channel <I>eclipse_stream_name</I></STRONG>
<DD> 
<BR>
Returns the Tcl channel name for the  queue with the
	symbolic name <I>eclipse_name</I>. 

<P>
<DT><STRONG><A NAME="1085"></A>ec_streamnum_to_channel <I>eclipse_stream_number</I></STRONG>
<DD> 
<BR>
Returns the Tcl channel name for the  queue with the
	ECLiPSe stream number <I>eclipse_stream_number</I>. 

<P>
<DT><STRONG><A NAME="1089"></A>ec_async_queue_create <I>eclipse_stream_name mode
	?command? ?event?</I></STRONG>
<DD> 
<BR>
This is provided mainly for compatibility with the Tcl remote
	interface. The command is an alias for <B>ec_queue_create</B> in the
	embedding interface. Certain uses of the queues in the embedding
	interface cannot be duplicated using the synchronous queues of the
	remote interface. Instead, asynchronous queues are needed (see
	chapter&nbsp;<A HREF="node24.html#chapremote">6</A> for more details). This command is
	provided to allow the same code to be used for both interfaces. 
	Note that it is possible to use the asynchronous queues of the remote
	interface in ways that are incompatible with the embedding interface.

<P>
</DL>

<P>

<H2><A NAME="SECTION00541000000000000000">
From-ECLiPSe to Tcl</A>
</H2>
To create a queue from ECLiPSe to Tcl, use <B>ec_queue_create</B> with
the <I>mode</I> argument set to <B>fromec</B>, e.g. 
<P><PRE>
Tcl:            set my_in_channel [ec_queue_create my_out_queue fromec]
</PRE>

<P>
Once the queue is created, it
can be used, e.g. by writing into it with ECLiPSe's
<A NAME="tex2html119"
 HREF="../bips/kernel/ioterm/write-2.html">write/2</A><A NAME="1349"></A> builtin,
and reading using Tcl's <B>read</B> command:<PRE>
ECLiPSe:        write(my_out_queue, hello),
                flush(my_out_queue).

Tcl:            set result [read $my_in_channel 5]
</PRE>
The disadvantage of using these low-level primitives is that
for reading one must know exactly how many bytes to read.
It is therefore recommended to use the EXDR (ECLiPSe external data
representation, see section <A HREF="node22.html#secexdrtcl">5.7</A>) format for communication.
This allows to send and receive structured and typed data.
The primitives to do that are
<A NAME="tex2html121"
 HREF="../bips/kernel/ioterm/write_exdr-2.html">write_exdr/2</A><A NAME="1352"></A>
on the ECLiPSe side and
ec_read_exdr (section <A HREF="node22.html#ecreadexdr">5.7</A>) on the Tcl side:<PRE>
ECLiPSe:        write_exdr(my_out_queue, foo(bar,3)),
                flush(my_out_queue).
	        
Tcl:            set result [ec_read_exdr $my_in_channel]
</PRE>
In the example, the Tcl result will be the list <TT>{foo bar 3}</TT>.
For details about the mapping see section <A HREF="node22.html#secexdrtcl">5.7</A>.

<P>

<H2><A NAME="SECTION00542000000000000000">
To-ECLiPSe from Tcl</A>
</H2>
To create a queue from Tcl to ECLiPSe to Tcl, use <B>ec_queue_create</B> with
the <I>mode</I> argument set to <B>toec</B>, e.g. <PRE>
Tcl:            set my_out_channel [ec_queue_create my_in_queue toec]
</PRE>
Now the queue can be used, e.g. by writing into it with Tcl's <B>puts</B>
command and by reading using ECLiPSe's
<A NAME="tex2html123"
 HREF="../bips/kernel/iochar/read_string-4.html">read_string/4</A><A NAME="1355"></A>
builtin:<PRE>
Tcl:            puts $my_out_channel hello
                ec_flush [ec_streamname_to_streamnum my_in_queue] 5

ECLiPSe:        read_string(my_in_queue, "", 5, Result).
</PRE>
The disadvantage of using these low-level primitives is that
for reading one must know exactly how many bytes to read, or define
a delimiter character.
It is therefore recommended to use the EXDR (ECLiPSe external data
representation, see section <A HREF="node22.html#secexdrtcl">5.7</A>) format for communication.
This allows to send and receive structured and typed data.
The primitives to do that are
ec_read_exdr (section <A HREF="node22.html#ecwriteexdr">5.7</A>) on the Tcl side and
<A NAME="tex2html125"
 HREF="../bips/kernel/ioterm/read_exdr-2.html">read_exdr/2</A><A NAME="1358"></A>
on the ECLiPSe side:<PRE>
Tcl:            ec_write_exdr $my_out_channel {foo bar 3} (SI)
                ec_flush [ec_streamname_to_streamnum my_in_queue]

ECLiPSe:        read_exdr(my_in_queue, Result).
</PRE>
In the example, the ECLiPSe result will be the term <TT>foo("bar",3)</TT>.
For details about the mapping see section <A HREF="node22.html#secexdrtcl">5.7</A>.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html936"
 HREF="node20.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html932"
 HREF="node15.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html926"
 HREF="node18.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html934"
 HREF="node76.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html937"
 HREF="node20.html">Attaching Handlers to Queues</A>
<B> Up:</B> <A NAME="tex2html933"
 HREF="node15.html">Embedding into Tcl/Tk</A>
<B> Previous:</B> <A NAME="tex2html927"
 HREF="node18.html">Passing Goals and Control</A>
 &nbsp <B>  <A NAME="tex2html935"
 HREF="node76.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey</I>
<BR><I>2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
