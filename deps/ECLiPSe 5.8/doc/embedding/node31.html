<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Additional Control and Support</TITLE>
<META NAME="description" CONTENT="Additional Control and Support">
<META NAME="keywords" CONTENT="embroot">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="embroot.css">
<LINK REL="next" HREF="node32.html">
<LINK REL="previous" HREF="node30.html">
<LINK REL="up" HREF="node24.html">
<LINK REL="next" HREF="node32.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html1135"
 HREF="node32.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html1131"
 HREF="node24.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html1125"
 HREF="node30.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html1133"
 HREF="node76.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1136"
 HREF="node32.html">Example</A>
<B> Up:</B> <A NAME="tex2html1132"
 HREF="node24.html">Remote Tcl Interface</A>
<B> Previous:</B> <A NAME="tex2html1126"
 HREF="node30.html">Communication via Queues</A>
 &nbsp <B>  <A NAME="tex2html1134"
 HREF="node76.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html1137"
 HREF="node31.html#SECTION00671000000000000000">Initialisation During Attachment</A>
<LI><A NAME="tex2html1138"
 HREF="node31.html#SECTION00672000000000000000">Disconnection and Control Transfer Support</A>
<UL>
<LI><A NAME="tex2html1139"
 HREF="node31.html#SECTION00672100000000000000">Tcl side</A>
<LI><A NAME="tex2html1140"
 HREF="node31.html#SECTION00672200000000000000">ECLiPSe side</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION00670000000000000000"></A>
<A NAME="remote-control"></A>
<BR>
Additional Control and Support
</H1>

<P>
The remote interface provides additional support for controlling the
interaction of the Tcl and ECLiPSe sides, such as explicit transfer of
control between ECLiPSe and Tcl, and the disconnection of the Tcl
and ECLiPSe sides. The interface also provides support for special
user-defined commands to be executed during these events.

<P>

<H2><A NAME="SECTION00671000000000000000">
Initialisation During Attachment</A>
</H2>

<P>
In an application, after the Tcl side has been attached, typically some
application specific initialisation needs to be performed, such as setting
up various data queues between the two sides, and defining the actions to
take when the two sides are disconnected. On both sides, these
initialisations can be performed immediately after attachment.  On the Tcl
side, such
actions can be specified in the optional <I>init_command</I> argument of
<I>ec_remote_init</I>. On the ECLiPSe side, such actions can be specified
in the `InitGoal' (last) argument of <I>remote_connect/3</I>. InitGoal can
be a built-in, or a user-defined goal.

<P>

<H2><A NAME="SECTION00672000000000000000">
Disconnection and Control Transfer Support</A>
</H2>

<P>
Disconnection should normally be performed when the ECLiPSe application
has finished using the GUI provided by the particular attached remote process.
The disconnection
may be initiated from either side. In addition to cleaning up and closing
all the remote queues connecting the two sides, the disconnection would
trigger the execution of user definable procedures on both sides (through an
event on the ECLiPSe side, and a call-back on the Tcl side), which can
be used to perform extra application specific cleanup and shutdown
routines. 

<P>
For the transfer of control from Tcl to ECLiPSe and vice versa, 
user-definable call-backs are made. This is to enable to define application
specific restrictions on what the GUI is allowed to do when the ECLiPSe
side has the control (for example, the GUI may have a button that sends an
rpc goal to ECLiPSe when pressed. Such a button could be disabled by the
call-back when control is transferred to ECLiPSe and reenabled when
control is transferred back to Tcl).

<P>
Note that there are two types of transfer of control from ECLiPSe to
Tcl: 1) when the control is implicitly yielded (e.g. initiating I/O
from ECLiPSe with Tcl, or returning after an rpc call); 2) when the
control is handed over by yielding explicitly (e.g. by calling
<A NAME="tex2html189"
 HREF="../bips/kernel/externals/remote_yield-1.html">remote_yield/1</A><A NAME="2521"></A> in ECLiPSe). With implicit yield, the Tcl side is
expected to eventually handed back control implicitly to ECLiPSe, and
not to explicitly hand control over to ECLiPSe before this. Thus two
call-backs are provided when control is yield to Tcl: one is executed
whenever the control is yielded, and the other is only executed when the
control is explicitly yielded. Thus when control is explicitly yielded,
both call-backs are executed. This can be useful for example by defining
the explicit yield call-back to enable a button on the Tcl side that will
explicitly transfer control back to ECLiPSe when pressed, which should
only be enabled when ECLiPSe explicitly yielded to Tcl.

<P>
On the ECLiPSe side, an event is raised when the two sides
disconnect. The event's name is the control stream's name. The user can
define a handler for this event to allow user-defined action to take place
on the ECLiPSe side on disconnection. The simplest way to define this
handler is to do it during the connection, via the last argument of <A NAME="tex2html191"
 HREF="../bips/kernel/externals/remote_connect-3.html">remote_connect/3</A><A NAME="2524"></A>.

<P>

<H3><A NAME="SECTION00672100000000000000">
Tcl side</A>
</H3>

<P>
<DL>
<DT><STRONG><A NAME="2357"></A>ec_running</STRONG>
<DD> 
<BR>
checks if the ECLiPSe side has control. Returns 1 if ECLiPSe
	side has control, 0 otherwise. If that is the case,
	then the Tcl side cannot issue an ec_rpc goal. Note that ec_running
	will return 1 before connection and after disconnection.
<DT><STRONG><A NAME="2360"></A>ec_connected</STRONG>
<DD> 
<BR>
checks if the Tcl side is currently attached to ECLiPSe. Returns
        1 if there is a connection to ECLiPSe (i.e. it is attached), 0
        otherwise. 
<DT><STRONG><A NAME="2363"></A>ec_resume</STRONG>
<DD> 
<BR>
explicitly hand-over control to ECLiPSe. Tcl side must have
	control when this command is called (i.e. <I>ec_running</I> must
	be false). This command returns when ECLiPSe side yields the
	control back to the Tcl side. Meanwhile, the Tcl process is not
        suspended as the Tcl event loop is entered while waiting for the
	yield. 
<DT><STRONG><A NAME="2367"></A>ec_running_set_commands <I>?start? ?end? ?yield? ?disconnect?</I></STRONG>
<DD> 
<BR>
set up commands that will be called just before control is handed
	over to ECLiPSe (<I>start</I>), when control is handed back from
	ECLiPSe (<I>end</I>), when ECLiPSe explicitly yields control
	(<I>yield</I>), and when the Tcl side is
	disconnected by the ECLiPSe side (<I>	disconnect</I>). The <I>start</I> and <I>end</I> commands are called
	both when control change hands explicitly (e.g. via <I>	ec_resume</I>), or implicitly (e.g. by making an rpc call or
	performing I/O on a synchronous remote queue). An explicit yield
	from ECLiPSe will in addition call the <I>yield</I> command, <I>	after</I> the <I>start</I> command is executed.

<P>
The default for each command is that no command will be called.

<P>
<DT><STRONG><A NAME="2384"></A>ec_disconnect <I>?side?</I></STRONG>
<DD> 
<BR>
disconnect the Tcl process from the ECLiPSe process. This closes
	all the connections between the two sides. The ECLiPSe side will
	abort from what it was doing. After disconnection, the
	two sides can no longer communicate, and <I>ec_running</I> will be
	set. The optional argument <I>side</I> specifies which side, tcl
	or eclipse,
	initiated the disconnection. For user's Tcl program, this will
	normally be the default tcl. If the disconnect is initiated from
	the Tcl side, this command will cause the ECLiPSe side to also
	close its connections to this remote connection, as well as
	raising the disconnect event in ECLiPSe associated with this
	remote connection. If the disconnect was initiated from
	the ECLiPSe side, then <I>ec_disconnect</I> will be called
	automatically with <I>side</I> set to eclipse, and the disconnect
	command set up by <I>ec_running_set_commands</I> will be executed.
</DL>

<P>

<H3><A NAME="SECTION00672200000000000000">
ECLiPSe side</A>
</H3>

<P>
<DL>
<DT><STRONG><A NAME="2399"></A>remote_yield(+Control)</STRONG>
<DD> 
<BR>
Explicitly yields control from ECLiPSe to the remote side with
	the control stream <I>Control</I>. ECLiPSe execution will suspend
	until control is transferred back to ECLiPSe. This predicate
	returns when ECLiPSe side resumes control.
	
<DT><STRONG><A NAME="2405"></A>remote_disconnect(+Control)</STRONG>
<DD> 
<BR>
Initiates disconnection from the remote side specified by <I>	Control</I>. This will close all connections between ECLiPSe and
	the remote side, on both sides. It will also cause an event <I>	Control</I> to be raised. 
</DL>

<P>
Note that if the ECLiPSe process is halted normally, then ECLiPSe
will try to disconnect from every remote side it may be connected to.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html1135"
 HREF="node32.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html1131"
 HREF="node24.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html1125"
 HREF="node30.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html1133"
 HREF="node76.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1136"
 HREF="node32.html">Example</A>
<B> Up:</B> <A NAME="tex2html1132"
 HREF="node24.html">Remote Tcl Interface</A>
<B> Previous:</B> <A NAME="tex2html1126"
 HREF="node30.html">Communication via Queues</A>
 &nbsp <B>  <A NAME="tex2html1134"
 HREF="node76.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey</I>
<BR><I>2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
