<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Definite Clause Grammars -- DCGs</TITLE>
<META NAME="description" CONTENT="Definite Clause Grammars -- DCGs">
<META NAME="keywords" CONTENT="umsroot">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="umsroot.css">
<LINK REL="previous" HREF="node69.html">
<LINK REL="up" HREF="node67.html">
<LINK REL="next" HREF="node71.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html3289"
 HREF="node71.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html3285"
 HREF="node67.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html3281"
 HREF="node69.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html3287"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html3290"
 HREF="node71.html">Events and Interrupts</A>
<B> Up:</B> <A NAME="tex2html3286"
 HREF="node67.html">ECLiPSe Macros</A>
<B> Previous:</B> <A NAME="tex2html3282"
 HREF="node69.html">Using the macros</A>
 &nbsp <B>  <A NAME="tex2html3288"
 HREF="node158.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html3291"
 HREF="node70.html#SECTION001231000000000000000">Simple DCG example</A>
<LI><A NAME="tex2html3292"
 HREF="node70.html#SECTION001232000000000000000">Mapping to Prolog Clauses</A>
<LI><A NAME="tex2html3293"
 HREF="node70.html#SECTION001233000000000000000">Parsing other Data Structures</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION001230000000000000000"></A>
<A NAME="dcg"></A><A NAME="6648"></A>
<A NAME="6649"></A>
<A NAME="6650"></A>
<BR>
Definite Clause Grammars -- DCGs
</H1>
<A NAME="6651"></A>
Grammar rules are described in many standard Prolog texts ([<A
 HREF="node159.html#clocksin81">2</A>]).
In ECLiPSe they are provided by a predefined global<A NAME="tex2html972"
 HREF="footnode.html#foot6654"><SUP>12.2</SUP></A> macro for
<TT>--&gt;/2</TT>.
When the parser reads a clause whose main functor is <TT>--&gt;/2</TT>, it transforms 
it according to the standard rules.
The syntax for DCGs is as follows: <PRE>
grammar_rule --&gt; grammar_head, ['--&gt;'], grammar_body.

grammar_head --&gt; non_terminal.
grammar_head --&gt; non_terminal, [','], terminal.

grammar_body --&gt; grammar_body, [','], grammar_body.
grammar_body --&gt; grammar_body, [';'], grammar_body.
grammar_body --&gt; grammar_body, ['-&gt;'], grammar_body.
grammar_body --&gt; grammar_body, ['|'], grammar_body.
grammar_body --&gt; iteration_spec, ['do'], grammar_body.
grammar_body --&gt; ['-?-&gt;'], grammar_body.
grammar_body --&gt; grammar_body_item.

grammar_body_item --&gt; ['!'].
grammar_body_item --&gt; ['{'], Prolog_goals, ['}'].
grammar_body_item --&gt; non_terminal.
grammar_body_item --&gt; terminal.
</PRE>
The non-terminals are syntactically identical to prolog goals (atom, compound
term or variable), the terminals are lists of prolog terms (typically
characters or tokens). Every 
term is transformed, unless it is enclosed in curly brackets. The control
constructs like conjunction <TT>,/2</TT>, disjunction (<TT>;/2</TT> or <TT>|/2</TT>),
the cut (<TT>!/0</TT>), the condition (<TT>-&gt;/1</TT>) and do-loops do not need to
be enclosed in curly brackets.

<P>
The grammar can be accessed with the built-in <A NAME="tex2html974"
 HREF="../bips/kernel/control/phrase-3.html">phrase/3</A><A NAME="6767"></A>.
The first argument of <A NAME="tex2html976"
 HREF="../bips/kernel/control/phrase-3.html">phrase/3</A><A NAME="6770"></A> is the name of the
grammar to be used, the 
second argument one is a list containing the input to be parsed. If the
parsing is successful the built-in will succeed.
For instance with the grammar<PRE>
a --&gt; [] | [z], a.
</PRE>
<TT>phrase(a, X, [])</TT> will give on backtracking: <TT>X = [z] ; X = [z, z] ; X = [z, z, z] ; ...</TT>.

<P>

<H2><A NAME="SECTION001231000000000000000">
Simple DCG example</A>
</H2>

<P>
The following example illustrates a simple grammar declared using the DCGs.

<P><PRE>
sentence --&gt; imperative, noun_phrase(Number), verb_phrase(Number).

imperative, [you] --&gt; [].
imperative --&gt; [].

noun_phrase(Number) --&gt; determiner, noun(Number).
noun_phrase(Number) --&gt; pronom(Number).

verb_phrase(Number) --&gt; verb(Number).
verb_phrase(Number) --&gt; verb(Number), noun_phrase(_).

determiner --&gt; [the].

noun(singular) --&gt; [man].
noun(singular) --&gt; [apple].
noun(plural) --&gt; [men].
noun(plural) --&gt; [apples].

verb(singular) --&gt; [eats].
verb(singular) --&gt; [sings].
verb(plural) --&gt; [eat].
verb(plural) --&gt; [sing].

pronom(plural) --&gt; [you].
</PRE>
The above grammar may be successfully parsed
using <A NAME="tex2html978"
 HREF="../bips/kernel/control/phrase-3.html">phrase/3</A><A NAME="6773"></A>. If the predicate
succeeds then the input has been parsed successfully.<PRE>
[eclipse 1]: phrase(sentence, [the,man,eats,the,apple], []).

yes.
[eclipse 2]: phrase(sentence, [the,men,eat], []).

yes.
[eclipse 3]: phrase(sentence, [the,men,eats], []).

no.
[eclipse 4]: phrase(sentence, [eat,the,apples], []).

yes.
[eclipse 5]: phrase(sentence, [you,eat,the,man], []). 

yes.
</PRE>
The predicate <A NAME="tex2html980"
 HREF="../bips/kernel/control/phrase-3.html">phrase/3</A><A NAME="6776"></A> may be used to return the point at which
parsing of a grammar fails -- if the returned list is empty then the
input has been successfully parsed.

<P><PRE>
[eclipse 1]: phrase(sentence, [the,man,eats,something,nasty],X).

X = [something, nasty]     More? (;) 

no (more) solution.
[eclipse 2]: phrase(sentence, [eat,the,apples],X).

X = [the, apples]     More? (;) 

X = []     More? (;) 

no (more) solution.
[eclipse 3]: phrase(sentence, [hello,there],X).

no (more) solution.
</PRE>

<P>

<H2><A NAME="SECTION001232000000000000000">
Mapping to Prolog Clauses</A>
</H2>
Grammar rule are translated to Prolog clauses by adding two arguments
which represent the input before and after the nonterminal which is
represented by the rule.
The effect of the transformation can be observed, e.g. by switching on
the <TT>all_dynamic</TT> flag so that the compiled clauses can be listed:<PRE>
[eclipse 1]: set_flag(all_dynamic, on), [user].
 p(X) --&gt; q(X).
 p(X) --&gt; [a].
user       compiled traceable 296 bytes in 0.25 seconds

yes.
[eclipse 2]: listing.
p(_g212, _g214, _g216) :-
        q(_g212, _g214, _g216).
p(_g212, _g214, _g216) :-
        _g214 = [a|_g216].

yes.
</PRE>

<P>

<H2><A NAME="SECTION001233000000000000000">
Parsing other Data Structures</A>
</H2>

<P>
DCGs are in principle not limited to the parsing of lists.
The predicate <A NAME="tex2html982"
 HREF="../bips/kernel/termmanip/C-3.html">'C'/3</A><A NAME="6779"></A> is responsible for reading resp. generating
the input tokens. The default definition is<PRE>
'C'([Token|Rest], Token, Rest).
</PRE>
The first argument represents the parsing input before consuming
Token and Rest is the input after consuming Token.

<P>
By redefining 'C'/3, it is possible to apply a DCG to other
input sources than a list, e.g. to parse directly from an I/O stream:<PRE>
:- local 'C'/3.
'C'(Stream-Pos0, Token, Stream-Pos1) :-
        seek(Stream, Pos0),
        read_string(Stream, " ", _, TokenString),
        atom_string(Token, TokenString),
        at(Stream, Pos1).

 sentence --&gt; noun, [is], adjective.
 noun --&gt; [prolog] ; [lisp].
 adjective --&gt; [boring] ; [great].
</PRE>
This can then be applied to a string as follows:<PRE>
[eclipse 1]: String = "prolog is great", open(String, string, S),
             phrase(sentence, S-0, S-End).
...
End = 15
yes.
</PRE>
Here is another redefinition of 'C'/3, using a similar idea, which allows
the direct parsing of ECLiPSe strings as sequences of characters:<PRE>
:- local 'C'/3.
'C'(String-Pos0, Char, String-Pos1) :-
        Pos0 =&lt; string_length(String),
        string_code(String, Pos0, Char),
        Pos1 is Pos0+1.

anagram --&gt; [].
anagram --&gt; [_].
anagram --&gt; [C], anagram, [C].
</PRE>
This can then be applied to a string as follows:<PRE>
[eclipse 1]: phrase(anagram, "abba"-1, "abba"-5).
yes.
[eclipse 2]: phrase(anagram, "abca"-1, "abca"-5).
no (more) solution.
</PRE>
Unlike the default definition, these redefinitions of 'C'/3 are not bi-directional.
Consequently, the grammar rules using them can only be used for parsing,
not for generating sentences.

<P>
Note that every grammar rule uses that definition of 'C'/3 which is visible in
the module where the grammar rule itself is defined.

<HR>
<!--Navigation Panel-->
<A NAME="tex2html3289"
 HREF="node71.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html3285"
 HREF="node67.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html3281"
 HREF="node69.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html3287"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html3290"
 HREF="node71.html">Events and Interrupts</A>
<B> Up:</B> <A NAME="tex2html3286"
 HREF="node67.html">ECLiPSe Macros</A>
<B> Previous:</B> <A NAME="tex2html3282"
 HREF="node69.html">Using the macros</A>
 &nbsp <B>  <A NAME="tex2html3288"
 HREF="node158.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey</I>
<BR><I>2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
