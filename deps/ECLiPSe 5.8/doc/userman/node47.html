<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Arithmetic Functions</TITLE>
<META NAME="description" CONTENT="Arithmetic Functions">
<META NAME="keywords" CONTENT="umsroot">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="umsroot.css">
<LINK REL="next" HREF="node48.html">
<LINK REL="previous" HREF="node46.html">
<LINK REL="up" HREF="node44.html">
<LINK REL="next" HREF="node48.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html2962"
 HREF="node48.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html2958"
 HREF="node44.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html2952"
 HREF="node46.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html2960"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html2963"
 HREF="node48.html">Low Level Arithmetic Builtins</A>
<B> Up:</B> <A NAME="tex2html2959"
 HREF="node44.html">Arithmetic Evaluation</A>
<B> Previous:</B> <A NAME="tex2html2953"
 HREF="node46.html">Numeric Types and Type</A>
 &nbsp <B>  <A NAME="tex2html2961"
 HREF="node158.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html2964"
 HREF="node47.html#SECTION00831000000000000000">Predefined Arithmetic Functions</A>
<LI><A NAME="tex2html2965"
 HREF="node47.html#SECTION00832000000000000000">Evaluation Mechanism</A>
<LI><A NAME="tex2html2966"
 HREF="node47.html#SECTION00833000000000000000">User Defined Arithmetic Functions</A>
<LI><A NAME="tex2html2967"
 HREF="node47.html#SECTION00834000000000000000">Runtime Expressions</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION00830000000000000000"></A>
<A NAME="4568"></A>
<BR>
Arithmetic Functions
</H1>

<H2><A NAME="SECTION00831000000000000000"></A>
<A NAME="4570"></A>
<BR>
Predefined Arithmetic Functions
</H2>
The following predefined arithmetic functions are available.
E, E1 and E2 stand for
arbitrary arithmetic expressions.

<P>
<PRE>
Function       Description                       Argument Types      Result
------------------------------------------------------------------------------
+ E            unary plus                        number              number
- E            unary minus                       number              number
abs(E)         absolute value                    number              number
sgn(E)         sign value                        number              integer
floor(E)       round down to integral value      number              number
ceiling(E)     round up to integral value        number              number
round(E)       round to nearest integral value   number              number

E1 + E2        addition                          number x number     number
E1 - E2        subtraction                       number x number     number
E1 * E2        multiplication                    number x number     number
E1 / E2        division                          number x number     see below
E1 // E2       integer division                  integer x integer   integer
E1 mod E2      modulus operation                 integer x integer   integer
gcd(E1,E2)     greatest common divisor           integer x integer   integer
lcm(E1,E2)     least common multiple             integer x integer   integer
E1 ^ E2        power operation                   number x number     number
min(E1,E2)     minimum of 2 values               number x number     number
max(E1,E2)     maximum of 2 values               number x number     number

\ E            bitwise complement                integer             integer
E1 /\ E2       bitwise conjunction               integer x integer   integer
E1 \/ E2       bitwise disjunction               integer x integer   integer
xor(E1,E2)     bitwise exclusive disjunction     integer x integer   integer
E1 &gt;&gt; E2       shift E1 right by E2 bits         integer x integer   integer
E1 &lt;&lt; E2       shift E1 left by E2 bits          integer x integer   integer
setbit(E1,E2)  set bit E2 in E1                  integer x integer   integer
clrbit(E1,E2)  clear bit E2 in E1                integer x integer   integer
getbit(E1,E2)  get of bit E2 in E1               integer x integer   integer

sin(E)         trigonometric function            number              float
cos(E)         trigonometric function            number              float
tan(E)         trigonometric function            number              float
asin(E)        trigonometric function            number              float
acos(E)        trigonometric function            number              float
atan(E)        trigonometric function            number              float
exp(E)         exponential function e^x          number              float
ln(E)          natural logarithm                 number              float
sqrt(E)        square root                       number              float
pi             the constant pi = 3.1415926...    ---                 float
e              the constant e = 2.7182818...     ---                 float

fix(E)         convert to integer (truncate)     number              integer
float(E)       convert to float                  number              float
rational(E)    convert to rational               number              rational
rationalize(E) convert to rational               number              rational
numerator(E)   extract numerator of a rational   integer or rational integer
denominator(E) extract denominator of a rational integer or rational integer
breal(E)       convert to bounded real           number              breal
breal_from_bounds(Lo, Hi)
               make bounded real from bounds     float x float       breal
breal_min(E)   lower bound of bounded real       breal               float
breal_max(E)   upper bound of bounded real       breal               float

sum(L)         sum of list elements              list                number
min(L)         minimum of list elements          list                number
max(L)         maximum of list elements          list                number
eval(E)        evaluate runtime expression       term                number
</PRE>

Argument types other than specified yield a type error.
As an argument type, <I>number</I> stands for <I>integer, rational, float
or breal</I> with the type conversions as specified above.
As a result type, <I>number</I> stands for
<I>the more general of the argument types</I>.
<A NAME="4577"></A>
<A NAME="4578"></A>
<A NAME="4579"></A>
The division operator <B>/</B> yields either a rational or a float result,
depending on the value of the global flag <TT>prefer_rationals</TT>.
The same is true for the result of &#94; if an integer is raised to
a negative integral power.

<P>
The relation between integer division <B>//</B> and modulus operation <B>mod</B>
is as follows:<PRE>
X =:= (X mod Y) + (X // Y) * Y
</PRE>

<P>

<H2><A NAME="SECTION00832000000000000000"></A>
<A NAME="4589"></A>
<BR>
Evaluation Mechanism
</H2>

<P>
An arithmetic expression is a Prolog term that is made up of variables,
numbers, atoms and compound terms, e.g.<PRE>
3 * 1.5 + Y / sqrt(pi)
</PRE>
Compound terms are evaluated by first evaluating their arguments and then
calling the corresponding evaluation predicate.
The evaluation predicate associated with a compound term <B>func(a_1,..,a_n)</B>
is the predicate <B>func/(n+1)</B>. It receives a_1,..,a_n as its first
n arguments and returns a numeric result as its last argument.
This result is then used in the arithmetic computation.
For instance, the expression above would be evaluated by the goal sequence<PRE>
*(3,1.5,T1), sqrt(3.14159,T2), /(Y,T2,T3), +(T1,T3,T4)
</PRE>
where T<I>i</I> are auxiliary variables created by the system to hold
intermediate results.

<P>
Although this evaluation mechanism is usually transparent to the user, it
becomes visible when errors occur, when subgoals are delayed, or
when inline-expanded code is traced.

<P>

<H2><A NAME="SECTION00833000000000000000"></A>
<A NAME="4602"></A>
<BR>
User Defined Arithmetic Functions
</H2>
This evaluation mechanism outlined above is not restricted to the
predefined arithmetic functions shown in the table.
In fact it works for all atoms and compound terms.
It is therefore possible to define a new arithmetic operation by
just defining an evaluating predicate:
<A NAME="4603"></A><PRE>
[eclipse 1]: [user].
 :- op(200, yf, !). % let's have some syntaxtic sugar
!(N, F) :- fac(N, 1, F).
 fac(0, F0, F) :- !, F=F0.
 fac(N, F0, F) :- N1 is N-1, F1 is F0*N, fac(N1, F1, F).
 user       compiled traceable 504 bytes in 0.00 seconds

yes.
[eclipse 2]: X is 23!. % calls !/2

X = 25852016738884976640000
yes.
</PRE>
Note that this mechanism is not only useful for user-defined predicates, but
can also be used to call ECLiPSe built-ins inside arithmetic expressions, eg.<PRE>
T is cputime - T0.
L is string_length("abcde") - 1.
</PRE>
which call <A NAME="tex2html588"
 HREF="../bips/kernel/opsys/cputime-1.html">cputime/1</A><A NAME="4684"></A> and <A NAME="tex2html590"
 HREF="../bips/kernel/stratom/string_length-2.html">string_length/2</A><A NAME="4687"></A> respectively.
Any predicate that returns a number as its last argument
can be used in a similar manner.

<P>
However there is a difference compared to the evaluation of the predefined
arithmetic functions (as listed in the table above):
The arguments of the user-defined arithmetic expression are <I>not
evaluated</I> but passed unchanged to the evaluating predicate.
E.g. the expression <TT>twice(3+4)</TT> is transformed into the goal
<TT>twice(3+4, Result)</TT> rather than <TT>twice(7, Result)</TT>.
This makes sense because otherwise it would not be possible to pass
any compound term to the predicate.
If evaluation is wanted, the user-defined predicate can explicitly call
<A NAME="tex2html592"
 HREF="../bips/kernel/arithmetic/is-2.html">is/2</A><A NAME="4690"></A> or use eval/1.

<P>

<H2><A NAME="SECTION00834000000000000000">
Runtime Expressions</A>
</H2>
In order to enable efficient compilation of arithmetic expressions,
ECLiPSe requires that variables in compiled arithmetic expressions
must be bound to numbers at runtime, not symbolic expressions.
E.g. in the following code <B>p/1</B> will only work when called with a
numerical argument, else it will raise error 24:<PRE>
p(Number) :- Res is 1 + Number, ...
</PRE>
To make it work even when the argument gets bound to a symbolic expression
at runtime, use eval/1 as in the following example:<PRE>
p(Expr) :- Res is 1 + eval(Expr), ...
</PRE>
If the expression is the only argument of is/2, the eval/1 may be omitted.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html2962"
 HREF="node48.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html2958"
 HREF="node44.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html2952"
 HREF="node46.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html2960"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html2963"
 HREF="node48.html">Low Level Arithmetic Builtins</A>
<B> Up:</B> <A NAME="tex2html2959"
 HREF="node44.html">Arithmetic Evaluation</A>
<B> Previous:</B> <A NAME="tex2html2953"
 HREF="node46.html">Numeric Types and Type</A>
 &nbsp <B>  <A NAME="tex2html2961"
 HREF="node158.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey</I>
<BR><I>2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
