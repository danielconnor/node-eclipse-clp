<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Inlining</TITLE>
<META NAME="description" CONTENT="Inlining">
<META NAME="keywords" CONTENT="umsroot">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="umsroot.css">
<LINK REL="next" HREF="node35.html">
<LINK REL="previous" HREF="node33.html">
<LINK REL="up" HREF="node27.html">
<LINK REL="next" HREF="node35.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html2740"
 HREF="node35.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html2736"
 HREF="node27.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html2730"
 HREF="node33.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html2738"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html2741"
 HREF="node35.html">Compiler Pragmas</A>
<B> Up:</B> <A NAME="tex2html2737"
 HREF="node27.html">The Compiler</A>
<B> Previous:</B> <A NAME="tex2html2731"
 HREF="node33.html">Mode Declarations</A>
 &nbsp <B>  <A NAME="tex2html2739"
 HREF="node158.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION00670000000000000000"></A>
<A NAME="2832"></A>
<A NAME="2833"></A>
<A NAME="2834"></A>
<BR>
Inlining
</H1>
To improve efficiency, calls to user-defined predicates can be
preprocessed and transformed at compile time.  The directive
<A NAME="tex2html304"
 HREF="../bips/kernel/database/inline-2.html">inline/2</A><A NAME="3202"></A>, e.g.<PRE>
:- inline(mypred/1, mytranspred/2).
</PRE>
arranges for mytranspred/2 to be invoked at compile time for each 
call to the predicate mypred/1 before this call is being compiled.

<P>
The transformation predicate receives the original call to mypred/1
as its first argument, and is expected to return a replacement goal
in its second argument. This replacement goal replaces the original
call in the compiled code. Usually, the replacement goal would be
semantically equivalent, but more efficient than the original goal.
When the transformation predicate fails, the original goal is not
replaced.

<P>
Typically, a predicate would be defined together with the corresponding
inlining transformation predicate, e.g.<PRE>
:- inline(double/2, trans_double/2).

double(X, Y) :-
        Y is 2*X.

trans_double(double(X, Y), Y=Result) :-
        not nonground(X), % if X already known at compile time:
Result is 2*X. % do calculation at compile time!
</PRE>
All compiled calls to double/2 will now be preprocessed by being passed
to trans_double/2.
E.g. if we now compile the following predicate involving double/2<PRE>
sample :-
        double(12,Y), ...,  double(Y,Z).
</PRE>
the first call to double will be replaced by <code>Y=24</code> while the
second one will be unaffected. The code that the compiler sees and
compiles is therefore<PRE>
sample :-
        Y=24, ...,  double(Y,Z).
</PRE>
Note that meta-calls (e.g. via
<A NAME="tex2html306"
 HREF="../bips/kernel/control/call-1.html">call/1</A><A NAME="3205"></A>) are never
preprocessed, they always go directly to the definition of double/2.

<P>
Transformation can be disabled for debugging purposes by adding<PRE>
:- pragma(noexpand).
</PRE>
to the compiled file, or by setting the global flag<PRE>
:- set_flag(goal_expansion, off).
</PRE>

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html2740"
 HREF="node35.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html2736"
 HREF="node27.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html2730"
 HREF="node33.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html2738"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html2741"
 HREF="node35.html">Compiler Pragmas</A>
<B> Up:</B> <A NAME="tex2html2737"
 HREF="node27.html">The Compiler</A>
<B> Previous:</B> <A NAME="tex2html2731"
 HREF="node33.html">Mode Declarations</A>
 &nbsp <B>  <A NAME="tex2html2739"
 HREF="node158.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey</I>
<BR><I>2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
