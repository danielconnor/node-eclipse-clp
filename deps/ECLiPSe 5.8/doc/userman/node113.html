<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Lower-level Primitives</TITLE>
<META NAME="description" CONTENT="Lower-level Primitives">
<META NAME="keywords" CONTENT="umsroot">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="umsroot.css">
<LINK REL="next" HREF="node114.html">
<LINK REL="previous" HREF="node112.html">
<LINK REL="up" HREF="node105.html">
<LINK REL="next" HREF="node114.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html3944"
 HREF="node114.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html3940"
 HREF="node105.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html3934"
 HREF="node112.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html3942"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html3945"
 HREF="node114.html">Demon Predicates</A>
<B> Up:</B> <A NAME="tex2html3941"
 HREF="node105.html">Advanced Control Features</A>
<B> Previous:</B> <A NAME="tex2html3935"
 HREF="node112.html">Waking conditions</A>
 &nbsp <B>  <A NAME="tex2html3943"
 HREF="node158.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html3946"
 HREF="node113.html#SECTION001781000000000000000">Suspensions and Suspension Lists</A>
<LI><A NAME="tex2html3947"
 HREF="node113.html#SECTION001782000000000000000">Creating Suspended Goals</A>
<LI><A NAME="tex2html3948"
 HREF="node113.html#SECTION001783000000000000000">Operations on Suspensions</A>
<LI><A NAME="tex2html3949"
 HREF="node113.html#SECTION001784000000000000000">Examining the Resolvent</A>
<LI><A NAME="tex2html3950"
 HREF="node113.html#SECTION001785000000000000000">Attaching Suspensions to Variables</A>
<LI><A NAME="tex2html3951"
 HREF="node113.html#SECTION001786000000000000000">User-defined Suspension Lists</A>
<LI><A NAME="tex2html3952"
 HREF="node113.html#SECTION001787000000000000000">Attaching Suspensions to Global Triggers</A>
<LI><A NAME="tex2html3953"
 HREF="node113.html#SECTION001788000000000000000">Scheduling Suspensions for Waking</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION001780000000000000000">
Lower-level Primitives</A>
</H1>

<P>
Suspended goals are actually represented by a special
opaque data type, called <B>suspension</B>, which can be explicitly
manipulated under program control using the primitives defined in
this section.
Although usually a suspended goal waits for some waking condition
in order to be reactivated, the primitives for suspension handling
do not enforce this. To provide maximum flexibility of use,
the functionalities of suspending and waking/scheduling are
separated from the trigger mechanisms that cause the waking. 

<P>
<A NAME="10504"></A>

<P>

<H2><A NAME="SECTION001781000000000000000">
Suspensions and Suspension Lists</A>
</H2>
A suspension represents a goal that is part of the resolvent.
Apart from the goal structure proper, it holds information that
is used for controlling its execution.
The components of a suspension are:
<DL>
<DT><STRONG>The goal structure</STRONG>
<DD>A term representing the goal itself, eg. <EM>X &gt;Y</EM>.
<DT><STRONG>The goal module</STRONG>
<DD>The module from which the goal was called.
<DT><STRONG>The goal priority</STRONG>
<DD>The priority with which the goal will be scheduled when
        it becomes woken.
<DT><STRONG>The state</STRONG>
<DD>This indicates the current position of the suspension within
        the resolvent. It is either suspended (sleeping), scheduled
	or executed (dead).
<DT><STRONG>Additional data</STRONG>
<DD>E.g. debugging information.
</DL>

<P>
Suspensions which should be woken by the same event are grouped
together in a <I>suspension list</I>.
<A NAME="10511"></A>
Suspension lists are either stored in an attribute of
an attributed variable or attached to a symbolic trigger.

<P>

<H2><A NAME="SECTION001782000000000000000"></A>
<A NAME="10513"></A>
<BR>
Creating Suspended Goals
</H2>
The most basic primitive to create a suspension is
<A NAME="tex2html1442"
 HREF="../bips/kernel/suspensions/make_suspension-3.html">make_suspension(Goal, Priority, Susp [, Module])</A><A NAME="10878"></A>
where <B>Goal</B> is the goal structure,
<B>Priority</B> is a small integer denoting the priority with which
the goal should be woken and <B>Susp</B> is the resulting suspension.

<P>
Note that usually
<A NAME="tex2html1444"
 HREF="../bips/kernel/suspensions/make_suspension-3.html">make_suspension/3,4</A><A NAME="10881"></A>
is not used directly, but implicitly via
<A NAME="tex2html1446"
 HREF="../bips/kernel/suspensions/suspend-3.html">suspend/3,4</A><A NAME="10884"></A> 
(described in section <A HREF="node111.html#suspend3">17.6</A>) which in addition attaches the suspension to a
trigger condition.

<P>
A suspension which has not yet been scheduled
for execution and executed, is called <EM>sleeping</EM>,
<A NAME="10526"></A>
a suspension which has already been executed is called
<EM>executed</EM> or <EM>dead</EM> (since it disappears from the resolvent,
but see section <A HREF="node114.html#secdemon">17.9</A> for an exception).
<A NAME="10530"></A>
A newly created suspension is always sleeping, however
note that due to backtracking, an executed suspension
can become sleeping again.
<A NAME="10531"></A>
Sometimes we use the term <EM>waking</EM>, which is less precise and
denotes the process of both scheduling and eventual execution.

<P>
By default, suspensions are printed as follows (the variants with invocation
numbers are used when the debugger is active):
<DIV ALIGN="CENTER">
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="CENTER">'SUSP-_78-susp'</TD>
<TD ALIGN="LEFT">sleeping suspension with id _78</TD>
</TR>
<TR><TD ALIGN="CENTER">'SUSP-_78-sched'</TD>
<TD ALIGN="LEFT">scheduled suspension with id _78</TD>
</TR>
<TR><TD ALIGN="CENTER">'SUSP-_78-dead'</TD>
<TD ALIGN="LEFT">dead suspension with id _78</TD>
</TR>
<TR><TD ALIGN="CENTER">'SUSP-123-susp'</TD>
<TD ALIGN="LEFT">sleeping suspension with invocation number 123</TD>
</TR>
<TR><TD ALIGN="CENTER">'SUSP-123-sched'</TD>
<TD ALIGN="LEFT">scheduled suspension with invocation number 123</TD>
</TR>
<TR><TD ALIGN="CENTER">'SUSP-123-dead'</TD>
<TD ALIGN="LEFT">dead suspension with id invocation number 123</TD>
</TR>
</TABLE>
</DIV>
It is possible to change the way suspensions are printed by defining a 
<A NAME="tex2html1451"
 HREF="../bips/kernel/syntax/portray-3.html">portray/3</A><A NAME="10887"></A>
transformation for the term type <TT>goal</TT>.

<P>

<H2><A NAME="SECTION001783000000000000000">
Operations on Suspensions</A>
</H2>
The following summarises the predicates that can be used to create, test,
decompose and destroy suspensions.
<DL>
<DT><STRONG><A NAME="tex2html1453"
 HREF="../bips/kernel/suspensions/make_suspension-3.html">make_suspension(Goal, Priority, Susp)</A><A NAME="10890"></A></STRONG>
<DD><DT><STRONG><A NAME="tex2html1455"
 HREF="../bips/kernel/suspensions/make_suspension-4.html">make_suspension(Goal, Priority, Susp, Module)</A><A NAME="10893"></A></STRONG>
<DD>Create a suspension <B>Susp</B> with a given priority from a given goal.
The goal will subsequently show up as a <I>delayed goal</I>.

<P>
<DT><STRONG><A NAME="tex2html1457"
 HREF="../bips/kernel/typetest/is_suspension-1.html">is_suspension(Susp)</A><A NAME="10896"></A></STRONG>
<DD>Succeeds if <B>Susp</B> is a sleeping or scheduled suspension,
fails if it is not a suspension or a suspension that has been already executed.

<P>
<DT><STRONG><A NAME="tex2html1459"
 HREF="../bips/kernel/typetest/type_of-2.html">type_of(S, goal)</A><A NAME="10899"></A></STRONG>
<DD>Succeeds if <B>S</B> is a suspension, no matter if it is
sleeping, scheduled or executed.

<P>
<DT><STRONG><A NAME="tex2html1461"
 HREF="../bips/kernel/suspensions/get_suspension_data-3.html">get_suspension_data(Susp, Name, Value)</A><A NAME="10902"></A></STRONG>
<DD>Extract any of the information contained in the suspension:
<B>Name</B> can be one of
<code>goal</code>, <code>module</code>, <code>priority</code>, <code>state</code> or <code>invoc</code> (debugger invocation number).

<P>
<DT><STRONG><A NAME="tex2html1463"
 HREF="../bips/kernel/suspensions/set_suspension_data-3.html">set_suspension_data(Susp, Name, Value)</A><A NAME="10905"></A></STRONG>
<DD>The <code>priority</code> and <code>invoc</code> (debugger invocation number) fields
of a suspension can be changed using this primitive.
If the priority of a sleeping suspension is changed,
this will only have an effect at the time the suspension gets
scheduled. If the suspension is already scheduled, changing
priority has no effect, except for future schedulings of demons
(see&nbsp;<A HREF="node114.html#secdemon">17.9</A>).

<P>
<DT><STRONG><A NAME="tex2html1465"
 HREF="../bips/kernel/suspensions/kill_suspension-1.html">kill_suspension(Susp)</A><A NAME="10908"></A></STRONG>
<DD>Convert the suspension <B>Susp</B> into an <I>executed</I>
one, ie. remove the suspended goal from the resolvent.
This predicate is meta-logical as its use may
change the semantics of the program.
</DL>

<P>

<H2><A NAME="SECTION001784000000000000000">
Examining the Resolvent</A>
</H2>
The system keeps track of all created suspensions and it
uses this data e.g. in the built-in predicates
<A NAME="tex2html1467"
 HREF="../bips/kernel/suspensions/delayed_goals-1.html">delayed_goals/1</A><A NAME="10911"></A>,
<A NAME="tex2html1469"
 HREF="../bips/kernel/suspensions/suspensions-1.html">suspensions/1</A><A NAME="10914"></A>,
<A NAME="tex2html1471"
 HREF="../bips/kernel/suspensions/current_suspension-1.html">current_suspension/1</A><A NAME="10917"></A>,
<A NAME="tex2html1473"
 HREF="../bips/kernel/suspensions/subcall-2.html">subcall/2</A><A NAME="10920"></A>
<A NAME="10582"></A>
and to detect floundering of the query given to the ECLiPSe top-level loop.

<P>

<H2><A NAME="SECTION001785000000000000000">
Attaching Suspensions to Variables</A>
</H2>

<P>
Suspensions are attached to variables by means of the attribute mechanism.
<A NAME="10585"></A>
For this purpose, a variable attribute needs to have one or more slots
reserved for <B>suspension lists</B>.
<A NAME="10587"></A>
Suspensions can then be inserted into one or several of those lists using
<DL>
<DT><STRONG><A NAME="tex2html1476"
 HREF="../bips/kernel/suspensions/insert_suspension-3.html">insert_suspension(Vars, Susp, Index)</A><A NAME="10923"></A></STRONG>
<DD>Insert the suspension <B>Susp</B> into the <B>Index</B>'th
suspension list of all attributed variables occurring in <B>Vars</B>.
The current module specifies which of the attributes will be taken.

<P>
<DT><STRONG><A NAME="tex2html1478"
 HREF="../bips/kernel/suspensions/insert_suspension-4.html">insert_suspension(Vars, Susp, Index, Module)</A><A NAME="10926"></A></STRONG>
<DD>Similar to <A NAME="tex2html1482"
 HREF="../bips/kernel/suspensions/insert_suspension-3.html">insert_suspension/3</A><A NAME="10929"></A>,
but it inserts the suspension into the attribute specified by <B>Module</B>.
</DL>

<P>
For instance,<PRE>
insert_suspension(Vars, Susp, inst of suspend, suspend)
</PRE>
inserts the suspension into the <B>inst</B>
list of the (system-predefined) <B>suspend</B>
attribute of all variables that occur in <B>Vars</B>, and<PRE>
insert_suspension(Vars, Susp, max of fd, fd)
</PRE>
would insert the suspension into the <B>max</B> list of the finite-domain
attribute of all variables in <B>Vars</B>.

<P>
Note that both predicates
find all attributed variables which occur in the general term <B>Vars</B> and for each of them,
locate the attribute which corresponds to the current module or the
<B>Module</B> argument respectively.
This attribute must be a structure, otherwise an error
is raised, which means that the attribute has to be initialised
before calling
<A NAME="tex2html1484"
 HREF="../bips/kernel/suspensions/insert_suspension-4.html">insert_suspension/4,3</A><A NAME="10932"></A>.
Finally, the <B>Index</B>'th argument of the attribute
is interpreted as a suspension list and the suspension
<B>Susp</B> is inserted at the beginning of this list.
A more user-friendly interface to access suspension lists is
provided by the
<A NAME="tex2html1486"
 HREF="../bips/kernel/suspensions/suspend-3.html">suspend/3</A><A NAME="10935"></A>
predicate.

<P>

<H2><A NAME="SECTION001786000000000000000">
User-defined Suspension Lists</A>
</H2>

<P>
Many important attributes and suspension lists are either provided by
the suspend-attribute or by libraries like the interval solver library lib(ic).
For those suspension lists, initialisation and waking is taken care of
by the library code.

<P>
For the implementation of user-defined suspension lists,
the following low-level primitives are provided:
<DL>
<DT><STRONG><A NAME="tex2html1488"
 HREF="../bips/kernel/suspensions/init_suspension_list-2.html">init_suspension_list(+Position, +Attribute)</A><A NAME="10938"></A></STRONG>
<DD>Initialises argument Position of Attribute to an empty suspension list.
<DT><STRONG><A NAME="tex2html1490"
 HREF="../bips/kernel/suspensions/merge_suspension_lists-4.html">merge_suspension_lists(+Pos1, +Attr1, +Pos2, +Attr2)</A><A NAME="10941"></A></STRONG>
<DD>Destructively appends the first suspension list (argument Pos1 of Attr1) to
    the end of the second (argument Pos2 of Attr2).
<DT><STRONG><A NAME="tex2html1492"
 HREF="../bips/kernel/suspensions/enter_suspension_list-3.html">enter_suspension_list(+Pos, +Attr, +Susp)</A><A NAME="10944"></A></STRONG>
<DD>Adds the suspension Susp to the suspension list in the
    argument position Pos of Attr. The suspension list can be pre-existing,
    or the argument could be uninstantiated, in which case a new suspension
    list will be created.
<DT><STRONG><A NAME="tex2html1494"
 HREF="../bips/kernel/suspensions/schedule_suspensions-2.html">schedule_suspensions(+Position, +Attribute)</A><A NAME="10947"></A></STRONG>
<DD>Takes the suspension list on argument position <B>Position</B> within
    <B>Attribute</B>, and schedule them for execution. 
    As a side effect, the suspension list within <B>Attribute</B> is updated,
    ie. suspensions which are no longer useful are removed destructively.
    See section <A HREF="node113.html#secwaking">17.8.8</A> for more details on waking.
</DL>

<P>

<H2><A NAME="SECTION001787000000000000000"></A>
<A NAME="10643"></A>
<A NAME="10644"></A>
<BR>
Attaching Suspensions to Global Triggers
</H2>
A single suspension or a list of suspensions can be attached to a
symbolic trigger by using
<A NAME="tex2html1498"
 HREF="../bips/kernel/suspensions/attach_suspensions-2.html">attach_suspensions(+Trigger, +Susps)</A><A NAME="10950"></A>.
A symbolic trigger can have an arbitrary name (an atom).

<P>

<H2><A NAME="SECTION001788000000000000000"></A>
<A NAME="secwaking"></A><A NAME="10650"></A>
<BR>
Scheduling Suspensions for Waking
</H2>
Suspended goals are woken by submitting at least one of the suspension lists
in which they occur to the waking scheduler.
The waking scheduler which maintains a global priority queue inserts
them into this queue according to their priority (see figure <A HREF="node107.html#figresolv">17.1</A>).
A suspension list can be passed to the scheduler by either of the predicates
<A NAME="tex2html1502"
 HREF="../bips/kernel/suspensions/schedule_suspensions-1.html">schedule_suspensions/1</A><A NAME="10953"></A>
(for triggers)
or
<A NAME="tex2html1504"
 HREF="../bips/kernel/suspensions/schedule_suspensions-2.html">schedule_suspensions/2</A><A NAME="10956"></A>
(for uder-defined suspension lists).
A suspension which has been scheduled in this way and awaits
its execution is called a <I>scheduled suspension</I>.

<P>
Note, however, that scheduling a suspension by means of
<A NAME="tex2html1506"
 HREF="../bips/kernel/suspensions/schedule_suspensions-1.html">schedule_suspensions/1</A><A NAME="10959"></A>
or
<A NAME="tex2html1508"
 HREF="../bips/kernel/suspensions/schedule_suspensions-2.html">schedule_suspensions/2</A><A NAME="10962"></A>
alone does not implicitly start the waking scheduler.
Instead, execution continues normally with the next goal in sequence after
schedule_suspensions/1,2.
The scheduler must be explicitly invoked by calling 
<A NAME="tex2html1510"
 HREF="../bips/kernel/suspensions/wake-0.html">wake/0</A><A NAME="10965"></A>.
Only then does it start to execute the woken suspensions.

<P>
The reason for having <A NAME="tex2html1512"
 HREF="../bips/kernel/suspensions/wake-0.html">wake/0</A><A NAME="10968"></A>
is to be able to schedule several suspension lists before the
priority-driven execution begins
<A NAME="tex2html1501"

HREF="footnode.html#foot10665"><SUP>17.5</SUP></A>.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html3944"
 HREF="node114.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html3940"
 HREF="node105.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html3934"
 HREF="node112.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html3942"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html3945"
 HREF="node114.html">Demon Predicates</A>
<B> Up:</B> <A NAME="tex2html3941"
 HREF="node105.html">Advanced Control Features</A>
<B> Previous:</B> <A NAME="tex2html3935"
 HREF="node112.html">Waking conditions</A>
 &nbsp <B>  <A NAME="tex2html3943"
 HREF="node158.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey</I>
<BR><I>2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
