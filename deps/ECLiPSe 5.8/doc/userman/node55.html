<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Stores</TITLE>
<META NAME="description" CONTENT="Stores">
<META NAME="keywords" CONTENT="umsroot">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="umsroot.css">
<LINK REL="next" HREF="node56.html">
<LINK REL="previous" HREF="node54.html">
<LINK REL="up" HREF="node51.html">
<LINK REL="next" HREF="node56.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html3067"
 HREF="node56.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html3063"
 HREF="node51.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html3057"
 HREF="node54.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html3065"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html3068"
 HREF="node56.html">Non-logical Variables</A>
<B> Up:</B> <A NAME="tex2html3064"
 HREF="node51.html">Non-logical Storage and References</A>
<B> Previous:</B> <A NAME="tex2html3058"
 HREF="node54.html">Shelves</A>
 &nbsp <B>  <A NAME="tex2html3066"
 HREF="node158.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION00940000000000000000">
Stores</A>
</H1>

<P>
<A NAME="4908"></A>
<A NAME="4909"></A>
A <B>store</B> is an anonymous object which can be used to store information
across failures.  A typical application is aggregating information across
multiple solutions.  Note that, if it is not necessary to save information
across backtracking, the use of the
<A NAME="tex2html627"
 HREF="../bips/lib/hash/index.html">library(hash)</A><A NAME="5134"></A>
is more appropriate and efficient than the facilities described here.

<P>
A store is a hash table which can store arbitrary terms under arbitrary
ground keys. Modifications of a store, as well as the entries within it,
survive backtracking.  The basic operations on stores are entering and
looking up information under a key, or retrieving the store contents as
a whole.

<P>
Stores come in two flavours:  anonymous stores are created with
<A NAME="tex2html629"
 HREF="../bips/kernel/arrays/store_create-1.html">store_create/1</A><A NAME="5137"></A>
and referred to by handle, while named stores are created with a
<A NAME="tex2html631"
 HREF="../bips/kernel/arrays/store-1.html">store/ 1</A><A NAME="5140"></A>
declaration and referred to by their name within a module. 
If possible, anonymous stores should be preferred because they make it
easier to write robust, reentrant code.  For example, an anonymous store
automatically disappears when the system backtracks over its creation,
or when the store handle gets garbage collected.  Named stores, on the
other hand, must be explicitly destroyed in order to free the
associated memory. 

<P>
Data is entered into a store using
<A NAME="tex2html633"
 HREF="../bips/kernel/arrays/store_set-3.html">store_set/3</A><A NAME="5143"></A>
and retrieved using
<A NAME="tex2html635"
 HREF="../bips/kernel/arrays/store_get-3.html">store_get/3</A><A NAME="5146"></A>.
It is possible to retrieve all keys with
<A NAME="tex2html637"
 HREF="../bips/kernel/arrays/stored_keys-2.html">stored_keys/2</A><A NAME="5149"></A>
or the full contents of the table with
<A NAME="tex2html639"
 HREF="../bips/kernel/arrays/stored_keys_and_values-2.html">stored_keys_and_values/2</A><A NAME="5152"></A>.
Entries can be deleted via
<A NAME="tex2html641"
 HREF="../bips/kernel/arrays/store_delete-2.html">store_delete/2</A><A NAME="5155"></A> or
<A NAME="tex2html643"
 HREF="../bips/kernel/arrays/store_erase-1.html">store_erase/1</A><A NAME="5158"></A>.

<P>
The following example computes how many solutions of each kind a goal has.
We use an anonymous store into which we enter counter values, using the
solution term as the key to distinguish the different counters:
<PRE>
    solutions_profile(Sol, Goal, Profile) :-
        store_create(Store),
        (
            call(Goal),
            ( store_get(Store, Sol, Old) -&gt;
                New is Old + 1,
                store_set(Store, Sol, New)
            ;
                store_set(Store, Sol, 1)
            ),
            fail
        ;
            stored_keys_and_values(Store, Profile)
        ).
</PRE>
Running this code produces for example:
<PRE>
    ?- solutions_profile(X, member(X, [a, b, c, b, a, b]), R).
    X = X
    R = [a - 2, b - 3, c - 1]
    Yes (0.00s cpu)
</PRE>

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html3067"
 HREF="node56.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html3063"
 HREF="node51.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html3057"
 HREF="node54.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html3065"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html3068"
 HREF="node56.html">Non-logical Variables</A>
<B> Up:</B> <A NAME="tex2html3064"
 HREF="node51.html">Non-logical Storage and References</A>
<B> Previous:</B> <A NAME="tex2html3058"
 HREF="node54.html">Shelves</A>
 &nbsp <B>  <A NAME="tex2html3066"
 HREF="node158.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey</I>
<BR><I>2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
