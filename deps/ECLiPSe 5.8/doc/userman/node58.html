<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Global References</TITLE>
<META NAME="description" CONTENT="Global References">
<META NAME="keywords" CONTENT="umsroot">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="umsroot.css">
<LINK REL="previous" HREF="node57.html">
<LINK REL="up" HREF="node51.html">
<LINK REL="next" HREF="node59.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html3101"
 HREF="node59.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html3097"
 HREF="node51.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html3093"
 HREF="node57.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html3099"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html3102"
 HREF="node59.html">Input and Output</A>
<B> Up:</B> <A NAME="tex2html3098"
 HREF="node51.html">Non-logical Storage and References</A>
<B> Previous:</B> <A NAME="tex2html3094"
 HREF="node57.html">Non-logical Arrays</A>
 &nbsp <B>  <A NAME="tex2html3100"
 HREF="node158.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION00970000000000000000"></A>
<A NAME="globrefs"></A>
<BR>
Global References
</H1>
Terms stored in non-logical variables and arrays are copies of the
<A NAME="tex2html697"
 HREF="../bips/kernel/arrays/setval-2.html">setval/2</A><A NAME="5221"></A> arguments,
and the terms obtained by <A NAME="tex2html699"
 HREF="../bips/kernel/arrays/getval-2.html">getval/2</A><A NAME="5224"></A> are thus not identical
to the original terms, in particular their variables are different.
Sometimes it is necessary to be able
to access the original term with its variables, i.e. to have
<I>global variables</I> in the meaning of conventional programming
languages.
A typical example is global state that a set of predicates wants to
share without having to pass an argument pair through all the
predicate invocations.

<P>
ECLiPSe offers the possibility to store references to general terms
and to access them even inside predicates that have no common variables
with the predicate that has stored them.
They are stored in so-called <B>references</B>.
<A NAME="5075"></A>
<A NAME="5076"></A>
For example,<PRE>
:- local reference(p).
</PRE>
or<PRE>
:- local reference(p, 0).
</PRE>
creates a named reference <B>p</B> (with an initial value of <B>0</B>)
which can be used to store references to terms.
This reference is accessed and modified in the same way as non-logical variables,
with <A NAME="tex2html703"
 HREF="../bips/kernel/arrays/setval-2.html">setval/2</A><A NAME="5227"></A>
and <A NAME="tex2html705"
 HREF="../bips/kernel/arrays/getval-2.html">getval/2</A><A NAME="5230"></A>,
but the following points are different for references:

<UL><LI>the accessed term is identical to the stored term (with its current
substitutions):<PRE>
[eclipse 1]: local reference(a), variable(b).

yes.
[eclipse 2]: Term = p(X), setval(a, Term), getval(a, Y), Y == Term.
X = X
Y = p(X)
Term = p(X)
yes.
[eclipse 3]: Term = p(X), setval(b, Term), getval(b, Y), Y == Term.

no (more) solution.
</PRE>

<P>

<LI>the modifications are backtrackable, when the execution fails
over the <A NAME="tex2html707"
 HREF="../bips/kernel/arrays/setval-2.html">setval/2</A><A NAME="5233"></A> call, the previous value of the global reference is restored

<P><PRE>
[eclipse 4]: setval(a, 1), (setval(a, 2), getval(a, X); getval(a, Y)).
X = 2
Y = Y     More? (;) 

X = X
Y = 1
</PRE>

<P>

<LI>there are no arrays of references, but the same effect can be
achieved by storing a structure in a reference and using the structure's
arguments. The arguments can then be accessed and modified using
<A NAME="tex2html709"
 HREF="../bips/kernel/termmanip/arg-3.html">arg/3</A><A NAME="5236"></A> and
<A NAME="tex2html711"
 HREF="../bips/kernel/termmanip/setarg-3.html">setarg/3</A><A NAME="5239"></A> respectively.

</UL>

<P>
The use of references should be considered carefully.
Their overuse can lead to programs which are
difficult to understand and difficult to optimize.
Typical applications use at most a single reference per module,
for example to hold state that would otherwise have to be passed
via additional arguments through many predicate invocations.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html3101"
 HREF="node59.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html3097"
 HREF="node51.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html3093"
 HREF="node57.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html3099"
 HREF="node158.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html3102"
 HREF="node59.html">Input and Output</A>
<B> Up:</B> <A NAME="tex2html3098"
 HREF="node51.html">Non-logical Storage and References</A>
<B> Previous:</B> <A NAME="tex2html3094"
 HREF="node57.html">Non-logical Arrays</A>
 &nbsp <B>  <A NAME="tex2html3100"
 HREF="node158.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey</I>
<BR><I>2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
