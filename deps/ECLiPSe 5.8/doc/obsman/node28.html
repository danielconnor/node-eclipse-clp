<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>User-defined constraints</TITLE>
<META NAME="description" CONTENT="User-defined constraints">
<META NAME="keywords" CONTENT="obsman">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="obsman.css">
<LINK REL="next" HREF="node29.html">
<LINK REL="previous" HREF="node27.html">
<LINK REL="up" HREF="node21.html">
<LINK REL="next" HREF="node29.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html762"
 HREF="node29.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html758"
 HREF="node21.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html752"
 HREF="node27.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html760"
 HREF="node34.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html763"
 HREF="node29.html">Example of defining a</A>
<B> Up:</B> <A NAME="tex2html759"
 HREF="node21.html">The Set Domain Library</A>
<B> Previous:</B> <A NAME="tex2html753"
 HREF="node27.html">When to use Set</A>
 &nbsp <B>  <A NAME="tex2html761"
 HREF="node34.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html764"
 HREF="node28.html#SECTION00371000000000000000">The abstract set data structure</A>
<LI><A NAME="tex2html765"
 HREF="node28.html#SECTION00372000000000000000">Set Domain access</A>
<LI><A NAME="tex2html766"
 HREF="node28.html#SECTION00373000000000000000">Set variable modification</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION00370000000000000000">
User-defined constraints</A>
</H1>

<P>
To define constraints based on set domains one needs to
access the properties of a set term like its domain, its cardinality,
its possible weight. As the set variable is a metaterm i.e. an
abstract data structure, some built-in predicates allow the user to
process the set variables and their domains, modify them and write new
constraint predicates. 

<P>

<H2><A NAME="SECTION00371000000000000000"></A>
<A NAME="2731"></A>
<BR>
The abstract set data structure
</H2>
A set domain variable is a metaterm. The <B>conjunto.pl</B> library
defines a metaterm attribute

<P>
<B>set with [setdom : [Glb,Lub], card: C, weight: W, del<code>_</code>inst: Dinst,
del<code>_</code>glb: Dglb, del<code>_</code>lub: Dlub, del<code>_</code>any: Dany]</B>

<P>
This attribute stores information regarding the set domain, its
cardinality, and weight (null if undefined) and together with four
suspension lists. The attribute arguments have the following meaning:

<P>

<UL><LI><B>setdom</B> The representation of the domain itself. As set
domains are treated as abstract data types, the users should not
access them directly, but only using built-in access and modification
predicates presented hereafter.

<LI><B>card</B> The representation of the set cardinality. The
cardinality is initialized as soon as a set domain is attached to
a set variable. It is either a finite domain or an integer. It can
be accessed and modified in the same way as set domains (using
specific built-in predicates).

<LI><B>weight</B> The representation of the set weight. The weight is
intialized to zero if the domain is not a weighted set domain, otherwise it
is computed as soon as a weighted set domain is attached to a set
variable. it can be accessed and modified in the same way as set
domains (using specific built-in predicates).

<LI><B>del<code>_</code>inst</B> A suspension list that should be woken
when the domain is reduced to a single set value.

<LI><B>del<code>_</code>glb</B> A suspension list that should be woken when
the lower bound of the set domain is updated.

<LI><B>del<code>_</code>lub</B> a suspension list that should be woken when
the upper bound of the set domain is updated.

<LI><B>del<code>_</code>any</B> a suspension list that should be woken when
any reduction of the domain is inferred.

</UL>

<P>
The attribute of a set domain variable can be accessed with the
predicate <B>svar<code>_</code>attribute/2</B> or by unification
in a matching clause:
<A NAME="2744"></A><PRE>
get_attribute(_{set: Attr}, A) :- -?-&gt; nonvar(Attr), Attr = A.
</PRE>
The attribute arguments can be accessed by macros from the ECLiPSe
<B>structures.pl</B> library, if e.g. <B>Attr</B> is the attribute of a
set domain variable, the del<code>_</code>inst list can be obtained by:<PRE>
arg(del_inst of set, Attr, Dinst)
</PRE>
or by using a unification: <PRE>
Attr = set with del_inst: Dinst
</PRE>
<A NAME="2759"></A>

<P>

<H2><A NAME="SECTION00372000000000000000">
Set Domain access</A>
</H2>
The domains are represented as abstract data types, and the users are
not supposed to access them directly. So we provide a number of
predicates to allow operations on set domains.

<P>

<A NAME="2761"></A>
<B>set<code>_</code>range(?Svar,?Glb,?Lub)</B> 
<A NAME="2763"></A>
<BLOCKQUOTE>
If <EM>Svar</EM> is a set domain variable, it returns the lower and upper
bounds of its domain.  Otherwise it fails.

</BLOCKQUOTE>
<B>glb(?Svar,?Glb)</B> 
<A NAME="2768"></A>
<BLOCKQUOTE>
If <EM>Svar</EM> is a set domain variable, it returns the lower bound of
its domain. Otherwise it fails.

</BLOCKQUOTE>
<B>lub(?Svar, ?Lub)</B>
<A NAME="2773"></A>
<BLOCKQUOTE>
If <EM>Svar</EM> is a set domain variable, it returns the upper bound of
its domain. Otherwise it fails.

</BLOCKQUOTE>
<B>el<code>_</code>weight(++E, ?We)</B>
<A NAME="2778"></A>
<BLOCKQUOTE>
If <EM>E</EM> is element of a weighted domain, it returns the weight
associated to <EM>E</EM>. Otherwise it fails.

</BLOCKQUOTE>
<B>max<code>_</code>weight(?Svar,?E)</B>
<A NAME="2784"></A>
<BLOCKQUOTE>
If <EM>Svar</EM> is a set variable, it returns the element of its domain
which belongs to the set resulting from the difference of the upper
bound and the lower bound and which has the greatest weight. If <EM>Svar</EM> is a ground set, it returns the element with the biggest weight.
Otherwise it fails.

</BLOCKQUOTE>

<P>
Two specific predicates make a link between a ground set and a list.

<P>

<B>set2list(++S, ?L)</B> 
<A NAME="2790"></A>
<BLOCKQUOTE>
If <EM>S</EM> is a ground set, it returns the corresponding list. If <EM>L</EM> is also ground it checks if it is the corresponding list. If not,
or if <EM>S</EM> is not ground, it fails.

</BLOCKQUOTE>
<B>list2set(++L, ?S)</B>
<A NAME="2797"></A>
<BLOCKQUOTE>
If <EM>L</EM> is a ground list, it returns the corresponding set. If <EM>S</EM> is also ground it checks if it is the corresponding set. If not,
or if <EM>L</EM> is not ground, it fails.

</BLOCKQUOTE>

<P>

<H2><A NAME="SECTION00373000000000000000">
Set variable modification</A>
</H2>
A specific predicate operate on the set domain <EM>variables</EM>.
<A NAME="2805"></A>
When a set domain is reduced, some suspension lists have to be
scheduled and woken depending on the bound modified. 
<A NAME="2806"></A>

<P>
<B>NOTE</B>: Their are 4 suspension lists in the <B>conjunto.pl</B>
library, which are woken precisely when the event associated with each
list occurs. For example, if the lower bound of a set variable is modified, two
suspension lists will be woken: the one associated to a <B>glb</B>
modification and the one associated to <B>any</B> modification. This
allows user-defined constraints to be handled efficiently. 

<P>

<B>modify<code>_</code>bound(Ind, ?S, ++Newbound)</B>
<A NAME="2812"></A>
<BLOCKQUOTE>
<EM>Ind</EM> is a flag which should take the value <B>lub</B> or <B>glb</B>,
otherwise it fails ! If <EM>S</EM> is a ground set, it succeeds if we
have <EM>Newbound</EM> equal to S. If <EM>S</EM> is a set variable, its new
lower or upper bound will be updated. For monotonicity reasons,
domains can only get reduced. So a new upper bound has to be contained
in the old one and a new lower bound has to contain the old one.
Otherwise it fails.

</BLOCKQUOTE>

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html762"
 HREF="node29.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html758"
 HREF="node21.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html752"
 HREF="node27.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html760"
 HREF="node34.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html763"
 HREF="node29.html">Example of defining a</A>
<B> Up:</B> <A NAME="tex2html759"
 HREF="node21.html">The Set Domain Library</A>
<B> Previous:</B> <A NAME="tex2html753"
 HREF="node27.html">When to use Set</A>
 &nbsp <B>  <A NAME="tex2html761"
 HREF="node34.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey <BR>
2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
