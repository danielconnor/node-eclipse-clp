<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>User defined constraints</TITLE>
<META NAME="description" CONTENT="User defined constraints">
<META NAME="keywords" CONTENT="libman">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="libman.css">
<LINK REL="previous" HREF="node18.html">
<LINK REL="up" HREF="node15.html">
<LINK REL="next" HREF="node20.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html1143"
 HREF="node20.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html1139"
 HREF="node15.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html1135"
 HREF="node18.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html1141"
 HREF="node71.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1144"
 HREF="node20.html">Additional Finite Domain Constraints</A>
<B> Up:</B> <A NAME="tex2html1140"
 HREF="node15.html">IC: A Hybrid Finite</A>
<B> Previous:</B> <A NAME="tex2html1136"
 HREF="node18.html">General Guidelines for the</A>
 &nbsp <B>  <A NAME="tex2html1142"
 HREF="node71.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html1145"
 HREF="node19.html#SECTION00341000000000000000">Modifying variable domains</A>
<LI><A NAME="tex2html1146"
 HREF="node19.html#SECTION00342000000000000000">The IC attribute</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION00340000000000000000">
User defined constraints</A>
</H1>

<P>
The library <A NAME="tex2html207"
 HREF="../bips/lib/ic_kernel/index.html">ic_kernel</A><A NAME="1365"></A> provides a
number of facilities useful for implementing IC constraints or otherwise
extending the facilities provided by the standard IC library.

<P>
While the <A NAME="tex2html209"
 HREF="../bips/lib/ic_kernel/index.html">ic_kernel</A><A NAME="1368"></A> library
exposes the structure of the IC attribute to the programmer (see below),
accessing it directly is strongly discouraged (if for no other reason,
the internals of IC may continue to evolve).
For accessing information about a variable and its domain, use the
predicates described earlier in section&nbsp;<A HREF="node17.html#domain-query">3.2.7</A> ``Variable query
predicates''.
For modifying a variable, it is particularly important to go through the
access predicates, in order to make sure that the internal state remains
consistent, appropriate constraints are scheduled for execution as a result
of the change, etc.
The predicates available for modifying a variable are discussed in the next
section.

<P>

<H2><A NAME="SECTION00341000000000000000">
Modifying variable domains</A>
</H2>

<P>
When using IC variables in normal code, one would typically use the
<code>$\=</code>, <code>$=&lt;</code> and <code>$&gt;=</code> family of constraints to (resp.)
remove a value, reduce the upper bound or increase the lower bound of a
variable.

<P>
While these constraints are good for normal CSP solving, they have a
number of properties which may be less desirable when writing new
constraints.  In particular, they may leave unwanted delayed goals
behind and may perform extra propagation before returning (it may be
desirable to perform all required bound updates before allowing further
propagation to occur).

<P>
To give the constraint writer more control over such matters, special
predicates exist in the <A NAME="tex2html225"
 HREF="../bips/lib/ic_kernel/index.html">ic_kernel</A><A NAME="1371"></A>
module which allow direct modification of the domain without the waking of
goals (they are scheduled for execution but not actually executed).
These predicates generally accept an IC variable, a non-IC variable (which
will be constrained to make it a real IC variable) or a number.

<P>
Full details on these predicates can be found in the reference manual; they
are listed here for completeness.  Note that with the exception of
<A NAME="tex2html227"
 HREF="../bips/lib/ic_kernel/impose_bounds-3.html">impose_bounds/3</A><A NAME="1374"></A> none of
the goals call <A NAME="tex2html229"
 HREF="../bips/kernel/suspensions/wake-0.html">wake/0</A><A NAME="1377"></A>, so
the programmer is free to do so at a convenient time.

<P>
<DL>
<DT><STRONG><A NAME="tex2html211"
 HREF="../bips/lib/ic_kernel/impose_min-2.html">impose_min/2</A><A NAME="1380"></A></STRONG>
<DD>Set the lowerbound.
<DT><STRONG><A NAME="tex2html213"
 HREF="../bips/lib/ic_kernel/impose_max-2.html">impose_max/2</A><A NAME="1383"></A></STRONG>
<DD>Set the upperbound.
<DT><STRONG><A NAME="tex2html215"
 HREF="../bips/lib/ic_kernel/impose_bounds-3.html">impose_bounds/3</A><A NAME="1386"></A></STRONG>
<DD>Sets both upper and lower bounds.
<DT><STRONG><A NAME="tex2html217"
 HREF="../bips/lib/ic_kernel/exclude-2.html">exclude/2</A><A NAME="1389"></A></STRONG>
<DD>Excludes an integer from an integral variable.
<DT><STRONG><A NAME="tex2html219"
 HREF="../bips/lib/ic_kernel/exclude_range-3.html">exclude_range/3</A><A NAME="1392"></A></STRONG>
<DD>Excludes a range of integers from an integral variable.
<DT><STRONG><A NAME="tex2html221"
 HREF="../bips/lib/ic_kernel/set_var_type-2.html">set_var_type/2</A><A NAME="1395"></A></STRONG>
<DD>Makes the variable be of the given type.
<DT><STRONG><A NAME="tex2html223"
 HREF="../bips/lib/ic_kernel/set_vars_type-2.html">set_vars_type/2</A><A NAME="1398"></A></STRONG>
<DD>Like set_var_type, but works for lists and submatrices of variables as well.
</DL>

<P>

<H2><A NAME="SECTION00342000000000000000">
The IC attribute</A>
</H2>

<P>
The IC attribute is a meta-term which is attached to all variables which
take part in IC constraints.
<A NAME="tex2html231"
 HREF="../bips/lib/ic_kernel/index.html">ic_kernel</A><A NAME="1401"></A> defines the IC
attribute as a structure of the following form:
<PRE>
ic with [var_type:Type,
         lo:Lo,
         hi:Hi,
         bitmap:Bitmap,
         min:SuspMin,
         max:SuspMax,
         hole:SuspHole,
         type:SuspType
        ]
</PRE>

<P>
This structure holds
<DL>
<DT><STRONG>var_type</STRONG>
<DD>The type of the variable.  This defaults to 'real' but may
become 'integer' after an explicit call to <B>integers/1</B>, by being
included in an integer constraint (e.g. <B>#=</B>) or by inferences made
during constraint propagation.
<P>
<DT><STRONG>lo</STRONG>
<DD>The lower bound of the variable's domain, as a float.
<DT><STRONG>hi</STRONG>
<DD>The lower bound of the variable's domain, as a float.
<DT><STRONG>bitmap</STRONG>
<DD>Where relevant, a bitmap represent the integer domain;
where not relevant it holds the atom <code>undefined</code>.

<P>
<DT><STRONG>min</STRONG>
<DD>Suspension list of goals to be woken on lower bound changes.
<DT><STRONG>max</STRONG>
<DD>Suspension list of goals to be woken on upper bound changes.

<P>
<DT><STRONG>hole</STRONG>
<DD>Suspension list of goals to be woken when a value is removed
from the middle of a domain.  Such removals only happen for integer
variables whose domain is finite.

<P>
<DT><STRONG>type</STRONG>
<DD>Suspension list of goals to be woken when a variable's type
becomes more constrained, i.e. when a variable goes from being real to
being integer.
</DL>

<P>
The suspension list names can be used in
<A NAME="tex2html233"
 HREF="../bips/kernel/suspensions/suspend-3.html">suspend/3</A><A NAME="1404"></A> and
related predicates to denote an appropriate waking condition.

<P>
The attribute of a domain variable can be accessed with the predicate
<A NAME="tex2html235"
 HREF="../bips/lib/ic_kernel/get_ic_attr-2.html">get_ic_attr/2</A><A NAME="1407"></A>.

<P>
As noted above, direct access and manipulation of the attribute is
discouraged; use the access predicates instead.

<P>
<A NAME="1100"></A>

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html1143"
 HREF="node20.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html1139"
 HREF="node15.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html1135"
 HREF="node18.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html1141"
 HREF="node71.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1144"
 HREF="node20.html">Additional Finite Domain Constraints</A>
<B> Up:</B> <A NAME="tex2html1140"
 HREF="node15.html">IC: A Hybrid Finite</A>
<B> Previous:</B> <A NAME="tex2html1136"
 HREF="node18.html">General Guidelines for the</A>
 &nbsp <B>  <A NAME="tex2html1142"
 HREF="node71.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey <BR>
2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
