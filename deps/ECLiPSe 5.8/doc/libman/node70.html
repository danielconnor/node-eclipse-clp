<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.2 beta5 (July 28th, 1998)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Examples</TITLE>
<META NAME="description" CONTENT="Examples">
<META NAME="keywords" CONTENT="libman">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="libman.css">
<LINK REL="previous" HREF="node69.html">
<LINK REL="up" HREF="node64.html">
<LINK REL="next" HREF="node71.html">
</HEAD>
<BODY >
<!--Navigation Panel-->
<A NAME="tex2html1989"
 HREF="node71.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html1985"
 HREF="node64.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html1981"
 HREF="node69.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html1987"
 HREF="node71.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1990"
 HREF="node71.html">Index</A>
<B> Up:</B> <A NAME="tex2html1986"
 HREF="node64.html">REPAIR: Constraint-Based Repair</A>
<B> Previous:</B> <A NAME="tex2html1982"
 HREF="node69.html">Invariants</A>
 &nbsp <B>  <A NAME="tex2html1988"
 HREF="node71.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html1991"
 HREF="node70.html#SECTION001061000000000000000">Interaction with Propagation</A>
<LI><A NAME="tex2html1992"
 HREF="node70.html#SECTION001062000000000000000">Repair Labeling</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION001060000000000000000">
Examples</A>
</H1>
More examples of repair library use, in particular in the area
of local search, can be found in the <EM>Tutorial on Search Methods</EM>.

<P>

<H2><A NAME="SECTION001061000000000000000">
Interaction with Propagation</A>
</H2>

<P>
<A NAME="5298"></A>
In the following example, we set up three constraints as both repair and
fd-constraints (using the <B>r_conflict_prop</B> annotation) and
install an initial tentative assignment (using <B>tent_set</B>).
We then observe the result by retrieving the conflict sets:<PRE>
[eclipse 1]: lib(repair), lib(fd). % libraries needed here
yes.
[eclipse 2]:
        fd:([X,Y,Z]::1..3), % the problem variables
fd:(Y #\= X) r_conflict_prop confset, % state the constraints
fd:(Y #\= Z) r_conflict_prop confset,
        fd:(Y #=  3) r_conflict_prop confset,
        [X,Y,Z] tent_set [1,2,3], % set initial assignment
[X,Y,Z] tent_get [NewX,NewY,NewZ], % get repaired solution
conflict_constraints(confset, Cs), % see the conflicts
conflict_vars(Vs).

X = X{fd:[1..3], repair:1}
Y = 3
Z = Z{fd:[1, 2], repair:3}
NewX = 1
NewY = 3
NewZ = 3
Cs = [3 #\= Z{fd:[1, 2], repair:3}]
Vs = [Z{fd:[1, 2], repair:3}]

Delayed goals:
     ...
yes.
</PRE>
Initially only the third constraint <code>Y #= 3</code> is inconsistent with the
tentative assignment. According to the definition of <B>r_conflict_prop</B>
this leads to
the constraint <code>Y #= 3</code> being propagated, which causes Y to be intantiated to 3
thus rendering the tentative value (2) irrelevant.

<P>
Now the constraint <code>Y #\= Z</code>, is in conflict since Y is now 3 and Z has the
tentative value 3 as well. The constraint starts to propagate and removes 3
from the domain of <code>Z [1..2]</code>. 

<P>
As a result Z becomes a conflict variable since its tentative value (3)
is no longer in its domain. The <code>Y #\= Z</code> constraint remains in the
conflict constraint set because Z has no valid tentative assignment.

<P>
The constraint <code>Y #\= X</code> is not affected, it neither goes into conflict
nor is its fd-version ever activated.

<P>
To repair the remaining conflicts and to find actual solutions,
the <code>repair/0</code> predicate described below could be used.

<P>

<H2><A NAME="SECTION001062000000000000000"></A>
<A NAME="labeling"></A>
<BR>
Repair Labeling
</H2>
This is an example for how to use the information provided by the repair
library to improve finite domain labeling.
<A NAME="5308"></A>
You can find the repair/1 predicate in the 'repairfd' library file.<PRE>
repair(ConflictSet) :-
    ( conflict_vars([C|_]) -&gt; % label conflict
indomain(C), %  variables first
repair(ConflictSet)
    ; conflict_constraints(ConflictSet, [C|_]) -&gt;
        term_variables(C, Vars), % choose one variable in
deleteffc(Var,Vars, _), %  the conflict constraint
Var tent_get Val,
        (Var = Val ; fd:(Var #\= Val)),
        repair(ConflictSet)
    ; % no more conflicts:
true % a solution is found.
).
</PRE>
The predicate is recursive and terminates when there are no more variables
or constraints in conflict.

<P>
Repair search often finishes without labeling all variables, a
solution has been found and a set of tenable variables are still
uninstantiated.  Thus even after the search is finished, Repair library
delayed goals used for monitoring constraints will be present in
anticipation of further changes.

<P>
To remove them one has to ground these tenable variables to their
tentative values.

<P>
Note that the example code never changes tentative values.
This has the advantage that this is still a complete, monotonic and
cycle-free algorithm.
However, it is not very realistic when the problem is difficult and
the solution is not close enough to the initial tentative assignment.
In that case, one would like to exploit the observation that it is often
possible to repair some conflict constraints by changing tentative
values. During search one would update the tentative values to be as
near as pssible to what one wants while maintaining consistency. If the
search leads to a failure these changes are of course undone.

<P>

<HR>
<!--Navigation Panel-->
<A NAME="tex2html1989"
 HREF="node71.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html1985"
 HREF="node64.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html1981"
 HREF="node69.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>  
<A NAME="tex2html1987"
 HREF="node71.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index_motif.gif"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1990"
 HREF="node71.html">Index</A>
<B> Up:</B> <A NAME="tex2html1986"
 HREF="node64.html">REPAIR: Constraint-Based Repair</A>
<B> Previous:</B> <A NAME="tex2html1982"
 HREF="node69.html">Invariants</A>
 &nbsp <B>  <A NAME="tex2html1988"
 HREF="node71.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Warwick Harvey <BR>
2005-01-25</I>
</ADDRESS>
</BODY>
</HTML>
